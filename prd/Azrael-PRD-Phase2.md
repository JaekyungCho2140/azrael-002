# Azrael PRD - Phase 2: ì´ë©”ì¼ ìƒì„±

**ìµœì¢… ì—…ë°ì´íŠ¸**: 2026-02-06
**ë²„ì „**: 3.0 (ìœ ë£Œí™” ìƒí’ˆ í˜‘ì˜ ì¼ì • ë³€ìˆ˜ ì¶”ê°€)
**ì°¸ì¡°**: [Azrael-PRD-Master.md](./Azrael-PRD-Master.md) | [Azrael-PRD-Shared.md](./Azrael-PRD-Shared.md)

**Phase 2 Status**: âœ… êµ¬í˜„ ì™„ë£Œ (2026-02-02)

---

## ğŸ“‹ ë¬¸ì„œ ê°œìš”

Phase 2ëŠ” **ì´ë©”ì¼ ìƒì„±** ê¸°ëŠ¥ì„ êµ¬í˜„í•©ë‹ˆë‹¤.

| ê¸°ëŠ¥ | í•µì‹¬ ê°€ì¹˜ |
|------|-----------|
| **ì´ë©”ì¼ ìƒì„±** | í˜‘ë ¥ì—…ì²´/ìœ ê´€ë¶€ì„œì— ì¼ì • ê³µìœ  ì‹œê°„ 80% ì ˆê° |

**ì „ì œì¡°ê±´**: Phase 0, 0.5, 1, 1.7 (âœ… ì™„ë£Œ)

---

# 1. ê¸°ëŠ¥ ëª©ì 

ê³„ì‚°ëœ ì¼ì • í…Œì´ë¸”(T1/T2/T3)ì„ ê¸°ë°˜ìœ¼ë¡œ **ì´ë©”ì¼ ë³¸ë¬¸(HTML)ì„ ìë™ ìƒì„±**í•©ë‹ˆë‹¤.

**ë°œì‹  ëŒ€ìƒ**:
- ë‚´ë¶€ ìœ ê´€ë¶€ì„œ: QA, ê°œë°œíŒ€, PM ë“±
- ì™¸ë¶€ í˜‘ë ¥ì—…ì²´: ë²ˆì—­ ë²¤ë”, ì™¸ì£¼ í˜‘ë ¥ì‚¬ ë“±

**ì£¼ìš” ê°€ì¹˜**:
- ì´ë©”ì¼ ì‘ì„± ì‹œê°„ 80% ì ˆê° (ìˆ˜ë™ 10ë¶„ â†’ ìë™ 2ë¶„)
- ì¼ê´€ëœ í˜•ì‹ì˜ ì „ë¬¸ì ì¸ ì´ë©”ì¼ ìƒì„±
- ë³µì‚¬-ë¶™ì—¬ë„£ê¸°ë¡œ Gmail/ì•„ì›ƒë£©ì— ì¦‰ì‹œ ë°œì‹  ê°€ëŠ¥

---

# 2. ê¸°ëŠ¥ ìƒì„¸

## 2.1 ì…ë ¥/ì¶œë ¥

| í•­ëª© | ì„¤ëª… |
|------|------|
| **ì…ë ¥** | ì„ íƒí•œ í…Œì´ë¸” (T1, T2, ë˜ëŠ” T3) - ì•„ë˜ í…Œì´ë¸” ëª…ì¹­ í‘œ ì°¸ê³  |
| **ì¶œë ¥** | ì´ë©”ì¼ ë³¸ë¬¸ (HTML í˜•ì‹) |
| **ë³¸ë¬¸ ë³µì‚¬ ë°©ì‹** | `navigator.clipboard.write()` (HTML + í”Œë ˆì¸í…ìŠ¤íŠ¸ ë™ì‹œ) |
| **ì œëª© ë³µì‚¬ ë°©ì‹** | `navigator.clipboard.writeText()` (í”Œë ˆì¸í…ìŠ¤íŠ¸ë§Œ) |

### í…Œì´ë¸” ëª…ì¹­ í‘œ

| ì½”ë“œ | ì¤„ì„ë§ | ì „ì²´ ëª…ì¹­ | ìš©ë„ |
|------|--------|----------|------|
| `table1` | T1 | ë‚´ë¶€ ì¼ì •í‘œ | ë‚´ë¶€ íŒ€ ì¼ì • ê´€ë¦¬ |
| `table2` | T2 | Ext. (ì™¸ë¶€ìš©) | ì™¸ë¶€ í˜‘ë ¥ì—…ì²´ ê³µìœ  |
| `table3` | T3 | Int. (ë‚´ë¶€ìš©) | ë‚´ë¶€ ìœ ê´€ë¶€ì„œ ê³µìœ  |

## 2.2 í…Œì´ë¸”ë³„ ì´ë©”ì¼ ì»¬ëŸ¼ êµ¬ì„±

> **ê²°ì • (M4)**: í…Œì´ë¸” íƒ€ì…ë³„ë¡œ ë‹¤ë¥¸ ì»¬ëŸ¼ êµ¬ì„± ì‚¬ìš©

| í…Œì´ë¸” | í¬í•¨ ì»¬ëŸ¼ |
|--------|----------|
| **T1** (ë‚´ë¶€ ì¼ì •í‘œ) | #, ë°°ì¹˜, ë§ˆê°, í…Œì´ë¸” ì „ë‹¬, ë‹´ë‹¹ì, ì„¤ëª… |
| **T2** (Ext. ì™¸ë¶€ìš©) | #, ë°°ì¹˜, HO, HB, ì„¤ëª… |
| **T3** (Int. ë‚´ë¶€ìš©) | #, ë°°ì¹˜, HO, HB, ì„¤ëª… |

### í•˜ìœ„ ì¼ê° í¬í•¨

> **ê²°ì • (M7, v2.4)**: í•˜ìœ„ ì¼ê°(depth=1)ë„ ì´ë©”ì¼ í…Œì´ë¸”ì— í¬í•¨. **ì‹œê°ì  êµ¬ë¶„ ì—†ìŒ** â€” ìƒìœ„/í•˜ìœ„ ì¼ê° ë™ì¼í•œ ìŠ¤íƒ€ì¼ë¡œ ë Œë”ë§.

```
# | ë°°ì¹˜ | ë§ˆê° | ...
1 | ì •ê¸° | 01/10(ê¸ˆ) 09:00 | ...
1.1 | ì •ê¸° | 01/11(í† ) 09:00 | ...
1.2 | ì •ê¸° | 01/12(ì¼) 09:00 | ...
2 | ì¶”ê°€ | 01/15(ìˆ˜) 09:00 | ...
```

### í•„ë“œ-ì»¬ëŸ¼ ë§¤í•‘ (ScheduleEntry â†’ ì´ë©”ì¼ í…Œì´ë¸”)

> **ê²°ì • (v2.2)**: schedule_entries í…Œì´ë¸”ì— description, assignee ì»¬ëŸ¼ ì¶”ê°€ (Â§6 ë§ˆì´ê·¸ë ˆì´ì…˜ ì°¸ì¡°)

| ScheduleEntry í•„ë“œ | T1 ì»¬ëŸ¼ | T2 ì»¬ëŸ¼ | T3 ì»¬ëŸ¼ |
|---------------------|---------|---------|---------|
| `index` | # | # | # |
| `stageName` | ë°°ì¹˜ | ë°°ì¹˜ | ë°°ì¹˜ |
| `startDateTime` | ë§ˆê° | HO | HO |
| `endDateTime` | í…Œì´ë¸” ì „ë‹¬ | HB | HB |
| `assignee` | ë‹´ë‹¹ì | - | - |
| `description` | ì„¤ëª… | ì„¤ëª… | ì„¤ëª… |

> **í…Œì´ë¸” ì…€ ë‚ ì§œ í˜•ì‹**: `formatTableDate()` (Shared.md Â§4.3) â†’ `"MM/DD(ìš”ì¼) HH:MM"` (ì˜ˆ: `01/10(ê¸ˆ) 09:00`)
> **ì´ë©”ì¼ ë³€ìˆ˜ ë‚ ì§œ í˜•ì‹**: `formatEmailDate()` (ë³¸ ë¬¸ì„œ Â§4.4 'ì´ë©”ì¼ ì „ìš© ë‚ ì§œ í˜•ì‹ í•¨ìˆ˜' ì°¸ì¡°) â†’ `"MM/DD(ìš”ì¼)"` (ì‹œê°„ ë¯¸í¬í•¨, ì˜ˆ: `01/10(ê¸ˆ)`)

### HTML í…Œì´ë¸” ì˜ˆì‹œ (T1)

```html
<table border="1" cellpadding="8" cellspacing="0" style="border-collapse: collapse; font-family: Arial, sans-serif; font-size: 14px;">
  <thead>
    <tr style="background-color: #f0f0f0;">
      <th style="padding: 8px; text-align: left;">#</th>
      <th style="padding: 8px; text-align: left;">ë°°ì¹˜</th>
      <th style="padding: 8px; text-align: left;">ë§ˆê°</th>
      <th style="padding: 8px; text-align: left;">í…Œì´ë¸” ì „ë‹¬</th>
      <th style="padding: 8px; text-align: left;">ë‹´ë‹¹ì</th>
      <th style="padding: 8px; text-align: left;">ì„¤ëª…</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="padding: 8px;">1</td>
      <td style="padding: 8px;">ì •ê¸°</td>
      <td style="padding: 8px;">01/10(ê¸ˆ) 09:00</td>
      <td style="padding: 8px;">01/15(ìˆ˜) 18:00</td>
      <td style="padding: 8px;">ì¡°ì¬ê²½</td>
      <td style="padding: 8px;"></td>
    </tr>
    <!-- ... -->
  </tbody>
</table>
```

### HTML í…Œì´ë¸” ì˜ˆì‹œ (T2/T3)

```html
<table border="1" cellpadding="8" cellspacing="0" style="border-collapse: collapse; font-family: Arial, sans-serif; font-size: 14px;">
  <thead>
    <tr style="background-color: #f0f0f0;">
      <th style="padding: 8px; text-align: left;">#</th>
      <th style="padding: 8px; text-align: left;">ë°°ì¹˜</th>
      <th style="padding: 8px; text-align: left;">HO</th>
      <th style="padding: 8px; text-align: left;">HB</th>
      <th style="padding: 8px; text-align: left;">ì„¤ëª…</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="padding: 8px;">1</td>
      <td style="padding: 8px;">ì •ê¸°</td>
      <td style="padding: 8px;">01/10(ê¸ˆ) 09:00</td>
      <td style="padding: 8px;">01/15(ìˆ˜) 18:00</td>
      <td style="padding: 8px;"></td>
    </tr>
    <!-- ... -->
  </tbody>
</table>
```

### HTML ì´ë©”ì¼ ìŠ¤íƒ€ì¼ ê°€ì´ë“œ

> Gmail/Outlook í˜¸í™˜ì„ ìœ„í•´ ëª¨ë“  ìŠ¤íƒ€ì¼ì€ inlineìœ¼ë¡œ ì ìš©í•©ë‹ˆë‹¤.

| ìš”ì†Œ | ìŠ¤íƒ€ì¼ |
|------|--------|
| **ë³¸ë¬¸ í…ìŠ¤íŠ¸** | `font-family: Arial, sans-serif; font-size: 14px; color: #333333; line-height: 1.6;` |
| **ì œëª©** | `font-size: 16px; font-weight: bold; color: #000000;` |
| **í…Œì´ë¸” í—¤ë”** | `background-color: #f0f0f0; padding: 8px; text-align: left;` |
| **í…Œì´ë¸” ì…€** | `padding: 8px; border: 1px solid #dddddd;` |
| **ë§í¬** | `color: #0066cc; text-decoration: underline;` |
| **Disclaimer** | `color: #666666; font-size: 12px;` |

## 2.3 ë¹ˆ í…Œì´ë¸” ì²˜ë¦¬

> **ê²°ì • (M6)**: ë¯¸ë¦¬ë³´ê¸°ì— ë©”ì‹œì§€ í‘œì‹œ, ë³µì‚¬ ë²„íŠ¼ì€ í™œì„±í™” ìœ ì§€

| ìƒí™© | ë™ì‘ |
|------|------|
| ì„ íƒí•œ í…Œì´ë¸”ì— ì—”íŠ¸ë¦¬ 0ê°œ | ë¯¸ë¦¬ë³´ê¸°ì— "(í•´ë‹¹ í…Œì´ë¸”ì— ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤)" ë©”ì‹œì§€ í‘œì‹œ |
| [í´ë¦½ë³´ë“œ ë³µì‚¬] í´ë¦­ | ë¹ˆ í…Œì´ë¸” í¬í•¨í•˜ì—¬ ë³µì‚¬ ê°€ëŠ¥ |

## 2.4 ì´ë©”ì¼ í…œí”Œë¦¿ ë³€ìˆ˜

| ë³€ìˆ˜ | ì„¤ëª… | í˜•ì‹ | ì‚¬ìš© ê°€ëŠ¥ ìœ„ì¹˜ | ì˜ˆì‹œ |
|------|------|------|---------------|------|
| `{updateDate}` | ì—…ë°ì´íŠ¸ ë‚ ì§œ | `MM/DD(ìš”ì¼)` | ì œëª© / ë³¸ë¬¸ | 02/10(ì›”) |
| `{updateDateShort}` | ì—…ë°ì´íŠ¸ ë‚ ì§œ (ì œëª©ìš©) | `MM-DD` | ì œëª© / ë³¸ë¬¸ | 02-10 |
| `{headsUp}` | í—¤ì¦ˆì—… ë‚ ì§œ | `MM/DD(ìš”ì¼)` | ë³¸ë¬¸ ì „ìš© | 01/28(í™”) |
| `{iosReviewDate}` | iOS ì‹¬ì‚¬ ë‚ ì§œ | `MM/DD(ìš”ì¼)` | ë³¸ë¬¸ ì „ìš© | 02/03(ì›”) |
| `{table}` | ì„ íƒí•œ í…Œì´ë¸” (HTML) | HTML (Â§2.2) | ë³¸ë¬¸ ì „ìš© | |
| `{disclaimer}` | í”„ë¡œì íŠ¸ Disclaimer | HTML (Â§2.7) | ë³¸ë¬¸ ì „ìš© + **ì¡°ê±´ë¶€ ë¸”ë¡** (`{{#if}}`) | |
| `{projectName}` | í”„ë¡œì íŠ¸ ì´ë¦„ | ë¬¸ìì—´ | ì œëª© / ë³¸ë¬¸ | M4/GL |
| `{paidProductDate}` | ìœ ë£Œí™” ìƒí’ˆ í˜‘ì˜ ë‚ ì§œ | `MM/DD(ìš”ì¼)` | ë³¸ë¬¸ ì „ìš© | 01/20(ì›”) |
| `{showIosReviewDate}` | iOS ì‹¬ì‚¬ì¼ í‘œì‹œ ì—¬ë¶€ | boolean (`project.showIosReviewDate && iosReviewDate != null`ìœ¼ë¡œ ê³„ì‚° â€” Â§4.4 context ì°¸ì¡°) | **ì¡°ê±´ë¶€ ë¸”ë¡ ì „ìš©** (`{{#if}}`) | true/false |
| `{showPaidProductDate}` | ìœ ë£Œí™” ìƒí’ˆ í˜‘ì˜ ì¼ì • í‘œì‹œ ì—¬ë¶€ | boolean (`project.showPaidProductDate && paidProductDate != null`ìœ¼ë¡œ ê³„ì‚°) | **ì¡°ê±´ë¶€ ë¸”ë¡ ì „ìš©** (`{{#if}}`) | true/false |

> **âš ï¸ ë³€ìˆ˜ ëª…ëª… ê·œì¹™ í†µì¼** (m9)
> - JIRA í…œí”Œë¦¿ê³¼ ë™ì¼í•˜ê²Œ **ì˜ì–´ ë³€ìˆ˜ëª…** ì‚¬ìš©
> - Shared.mdì— ê³µí†µ ë³€ìˆ˜ ê·œì¹™ ì •ì˜ ì˜ˆì •

### ë³€ìˆ˜ null/ë¹ˆ ê°’ ì²˜ë¦¬

> **ê²°ì • (v2.2)**: í”Œë ˆì´ìŠ¤í™€ë” í‘œì‹œ

| ìƒí™© | ì²˜ë¦¬ |
|------|------|
| ë³€ìˆ˜ ê°’ì´ `null` ë˜ëŠ” `undefined` | `[ë¯¸ì…ë ¥]` í”Œë ˆì´ìŠ¤í™€ë” í…ìŠ¤íŠ¸ í‘œì‹œ |
| ë³€ìˆ˜ ê°’ì´ ë¹ˆ ë¬¸ìì—´ `""` | ë¹ˆ ë¬¸ìì—´ ê·¸ëŒ€ë¡œ ì¶œë ¥ (ì˜ë„ì  ë¹„ì›€) |
| ì¡°ê±´ë¶€ ë¸”ë¡ (`{{#if}}`) | falsy ê°’ì´ë©´ ë¸”ë¡ ì „ì²´ ì œê±° (ê¸°ì¡´ ë™ì‘ ìœ ì§€) |

### í…œí”Œë¦¿ ë³€ìˆ˜ ìœ íš¨ì„± ê²€ì¦

> **ê²°ì •**: ì €ì¥ ì‹œ ê²½ê³  í‘œì‹œ + ê·¸ëŒ€ë¡œ ì¶œë ¥

| ìƒí™© | ì²˜ë¦¬ |
|------|------|
| ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë³€ìˆ˜ (`{ì—†ëŠ”ë³€ìˆ˜}`) | ì €ì¥ ì‹œ ê²½ê³  í† ìŠ¤íŠ¸ + ê·¸ëŒ€ë¡œ ì¶œë ¥ |
| ë¬¸ë²• ì˜¤ë¥˜ (`{ë³€ìˆ˜` ë‹«ëŠ” ê´„í˜¸ ëˆ„ë½) | ì €ì¥ ì‹œ ê²½ê³  í† ìŠ¤íŠ¸ + ê·¸ëŒ€ë¡œ ì¶œë ¥ |

```typescript
// ë³€ìˆ˜ ìœ íš¨ì„± ê²€ì¦ ë¡œì§
// âš ï¸ Â§2.4 ì´ë©”ì¼ í…œí”Œë¦¿ ë³€ìˆ˜ í…Œì´ë¸”ê³¼ ë™ê¸°í™” í•„ìˆ˜
const VALID_VARIABLES = [
  'updateDate', 'updateDateShort', 'headsUp', 'iosReviewDate',
  'paidProductDate', 'table', 'disclaimer', 'projectName',
  'showIosReviewDate', 'showPaidProductDate',
];

// v2.7: boolean ì „ìš© ë³€ìˆ˜ â€” ì¡°ê±´ë¶€ ë¸”ë¡({{#if}})ì—ì„œë§Œ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ë³€ìˆ˜
const BOOLEAN_ONLY_VARIABLES = ['showIosReviewDate', 'showPaidProductDate'];

function validateTemplate(template: string): string[] {
  const warnings: string[] = [];

  // 1. ë‹¨ìˆœ ë³€ìˆ˜ ê²€ì¦ (ì¡°ê±´ë¶€ ë¸”ë¡ ë‚´ë¶€ í¬í•¨ â€” v2.5)
  const variablePattern = /\{(\w+)\}/g;
  let match;
  while ((match = variablePattern.exec(template)) !== null) {
    if (!VALID_VARIABLES.includes(match[1])) {
      warnings.push(`ì•Œ ìˆ˜ ì—†ëŠ” ë³€ìˆ˜: {${match[1]}}`);
    }
    // v2.7: boolean ë³€ìˆ˜ë¥¼ ë‹¨ìˆœ ë³€ìˆ˜ë¡œ ì‚¬ìš© ì‹œ ê²½ê³ 
    if (BOOLEAN_ONLY_VARIABLES.includes(match[1])) {
      warnings.push(`{${match[1]}}ëŠ” ì¡°ê±´ë¶€ ë¸”ë¡({{#if}})ì—ì„œë§Œ ì‚¬ìš©í•˜ì„¸ìš”. ë‹¨ìˆœ ë³€ìˆ˜ë¡œ ì‚¬ìš©í•˜ë©´ "true"/"false" í…ìŠ¤íŠ¸ê°€ ì¶œë ¥ë©ë‹ˆë‹¤.`);
    }
  }

  // 2. ë‹«íˆì§€ ì•Šì€ ì¤‘ê´„í˜¸ ê²€ì‚¬
  const unclosedPattern = /\{[^}]*$/gm;
  if (unclosedPattern.test(template)) {
    warnings.push('ë‹«íˆì§€ ì•Šì€ ì¤‘ê´„í˜¸ê°€ ìˆìŠµë‹ˆë‹¤.');
  }

  // 3. ì¤‘ì²© ì¡°ê±´ë¶€ ë¸”ë¡ ê°ì§€ (v2.5: ì¤‘ì²© ë¯¸ì§€ì›, v2.6: ì •í™•í•œ ê°ì§€ regex)
  //    ê¸°ì¡´ /[\s\S]*?/ íŒ¨í„´ì€ {{/if}}ë¥¼ ë„˜ì–´ì„œ ë§¤ì¹­í•  ìˆ˜ ìˆì–´
  //    ë³„ê°œì˜ ë‘ ì¡°ê±´ë¶€ ë¸”ë¡ì„ ì¤‘ì²©ìœ¼ë¡œ ì˜¤íƒì§€í•  ìˆ˜ ìˆìŒ.
  //    ê°œì„ : {{/if}} ì´ì „ê¹Œì§€ë§Œ íƒìƒ‰í•˜ì—¬ ì‹¤ì œ ì¤‘ì²©ë§Œ ê°ì§€.
  const nestedPattern = /\{\{#if (\w+)\}\}(?:(?!\{\{\/if\}\})[\s\S])*?\{\{#if \w+\}\}/;
  if (nestedPattern.test(template)) {
    warnings.push('ì¤‘ì²©ëœ ì¡°ê±´ë¶€ ë¸”ë¡({{#if}})ì€ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
  }

  // 4. ë‹«íˆì§€ ì•Šì€ ì¡°ê±´ë¶€ ë¸”ë¡ ê°ì§€ (v2.7: {{#if}} ì—´ê³  {{/if}}ë¡œ ë‹«ì§€ ì•Šì€ ê²½ìš°)
  const openCount = (template.match(/\{\{#if \w+\}\}/g) || []).length;
  const closeCount = (template.match(/\{\{\/if\}\}/g) || []).length;
  if (openCount > closeCount) {
    warnings.push(`ë‹«íˆì§€ ì•Šì€ ì¡°ê±´ë¶€ ë¸”ë¡ì´ ${openCount - closeCount}ê°œ ìˆìŠµë‹ˆë‹¤. {{/if}}ë¥¼ í™•ì¸í•˜ì„¸ìš”.`);
  } else if (closeCount > openCount) {
    warnings.push(`ì—¬ëŠ” íƒœê·¸ ì—†ì´ {{/if}}ê°€ ${closeCount - openCount}ê°œ ìˆìŠµë‹ˆë‹¤.`);
  }

  // 5. TipTap HTML íƒœê·¸ê°€ ë³€ìˆ˜ êµ¬ë¬¸ì„ ê°ì‹¸ëŠ” ê²½ìš° ê²½ê³  (v2.7)
  //    ì˜ˆ: <span>{variable}</span> ë‚´ë¶€ì˜ ë³€ìˆ˜ëŠ” ì •ìƒ ë™ì‘í•˜ì§€ë§Œ,
  //    <span>{vari</span><span>able}</span>ì²˜ëŸ¼ ë¶„ë¦¬ëœ ê²½ìš° ì¹˜í™˜ ì‹¤íŒ¨.
  //    âš ï¸ TipTapì€ í¸ì§‘ ì¤‘ íƒœê·¸ë¥¼ ìë™ ì‚½ì…í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì‚¬ìš©ì ì£¼ì˜ í•„ìš”.
  //    ê°ì§€: ì—´ë¦° {ì™€ ë‹«íŒ } ì‚¬ì´ì— HTML íƒœê·¸ê°€ í¬í•¨ëœ íŒ¨í„´
  const brokenVariablePattern = /\{[^}]*<[^>]+>[^}]*\}/g;
  if (brokenVariablePattern.test(template)) {
    warnings.push('ë³€ìˆ˜ êµ¬ë¬¸ ë‚´ì— HTML íƒœê·¸ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. TipTap ì—ë””í„°ì—ì„œ ë³€ìˆ˜ í…ìŠ¤íŠ¸ì— ì„œì‹ì„ ì ìš©í•˜ë©´ ì¹˜í™˜ì´ ì‹¤íŒ¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
  }

  return warnings;
}
```

> **TipTap ë³€ìˆ˜ ë³´í˜¸ ì •ì±… (v2.7)**: TipTap ì—ë””í„°ëŠ” í…ìŠ¤íŠ¸ì— ìë™ìœ¼ë¡œ `<span>` ë“±ì˜ HTML íƒœê·¸ë¥¼ ì‚½ì…í•  ìˆ˜ ìˆì–´, `{variable}` êµ¬ë¬¸ì´ `<span>{vari</span><span>able}</span>`ì²˜ëŸ¼ ë¶„ë¦¬ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê²½ìš° ë³€ìˆ˜ ì¹˜í™˜ì´ ì‹¤íŒ¨í•©ë‹ˆë‹¤.
> - **ì •ì±…**: ì‚¬ìš©ì ì±…ì„. validateTemplateì—ì„œ ê²½ê³ ë§Œ í‘œì‹œí•˜ë©°, TipTap Node ìˆ˜ì¤€ì˜ ë³´í˜¸ëŠ” êµ¬í˜„í•˜ì§€ ì•ŠìŒ.
> - **ê¶Œì¥**: ë³€ìˆ˜ í…ìŠ¤íŠ¸ì— Bold/Italic ë“± ì„œì‹ì„ ì ìš©í•˜ì§€ ì•Šë„ë¡ ì‚¬ìš©ì ì•ˆë‚´.
> - **ê°ì§€**: ì €ì¥ ì‹œ `brokenVariablePattern` ê²€ì‚¬ë¡œ ê¹¨ì§„ ë³€ìˆ˜ ê²½ê³  í‘œì‹œ.

## 2.5 ì¡°ê±´ë¶€ ë Œë”ë§ (ìì²´ ê²½ëŸ‰ íŒŒì„œ)

> **ê²°ì • (C1)**: ìì²´ ê²½ëŸ‰ íŒŒì„œ êµ¬í˜„ - ë‹¨ìˆœ ë³€ìˆ˜ `{var}` + ì¡°ê±´ë¶€ ë¸”ë¡ `{{#if}}` ê³µì¡´

### ë¬¸ë²•

- **ë‹¨ìˆœ ë³€ìˆ˜**: `{variableName}` (ë‹¨ì¼ ì¤‘ê´„í˜¸)
- **ì¡°ê±´ë¶€ ë¸”ë¡**: `{{#if condition}}...{{/if}}` (ì´ì¤‘ ì¤‘ê´„í˜¸, Handlebars ìŠ¤íƒ€ì¼)

### ì¡°ê±´ë¶€ ë¸”ë¡ ì˜ˆì‹œ

```html
{{#if showIosReviewDate}}
  <li>â–¡ iOS ì‹¬ì‚¬ì¼: {iosReviewDate}</li>
{{/if}}
```

### ì²˜ë¦¬ ê·œì¹™

| ì¡°ê±´ | ì²˜ë¦¬ |
|------|------|
| `showIosReviewDate = true` | ë¸”ë¡ ë‚´ìš© ë Œë”ë§ |
| `showIosReviewDate = false` | ë¸”ë¡ ì „ì²´ ì œê±° |
| `iosReviewDate = null` | ë¸”ë¡ ì „ì²´ ì œê±° (`showIosReviewDate`ê°€ `project.showIosReviewDate && iosReviewDate != null`ë¡œ ê³„ì‚°ë˜ë¯€ë¡œ false â€” Â§4.4 context ì°¸ì¡°) |

### íŒŒì„œ êµ¬í˜„

```typescript
// src/lib/email/templateParser.ts

/**
 * ì¡°ê±´ë¶€ ë¸”ë¡ ì²˜ë¦¬ (ì¤‘ì²© ë¯¸ì§€ì› â€” v2.5)
 * âš ï¸ ì¤‘ì²© {{#if}} ì‚¬ìš© ì‹œ ë™ì‘ì´ ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥í•¨ (ë¹„íƒìš• regexë¡œ ë‚´ì¸¡/ì™¸ì¸¡ ì²˜ë¦¬ ìˆœì„œ ë³´ì¥ ë¶ˆê°€).
 *    ì €ì¥ ì‹œ ì¤‘ì²© ê°ì§€ ê²½ê³  í‘œì‹œ (v2.5, v2.6: ê²½ê³  ë¬¸êµ¬ ê°œì„ ).
 */
function processConditionals(template: string, context: TemplateContext): string {
  return template.replace(
    /\{\{#if (\w+)\}\}([\s\S]*?)\{\{\/if\}\}/g,
    (_, key, content) => context[key] ? content : ''
  );
}

/**
 * ë‹¨ìˆœ ë³€ìˆ˜ ì¹˜í™˜
 * - null/undefined â†’ '[ë¯¸ì…ë ¥]' í”Œë ˆì´ìŠ¤í™€ë” í‘œì‹œ (v2.2)
 * - boolean â†’ String(value) ë³€í™˜ (v2.5)
 * - ë¹ˆ ë¬¸ìì—´ â†’ ê·¸ëŒ€ë¡œ ì¶œë ¥
 */
function replaceVariables(template: string, context: TemplateContext): string {
  return template.replace(
    /\{(\w+)\}/g,
    (_, key) => {
      const value = context[key];
      if (value == null) return '[ë¯¸ì…ë ¥]';           // nullê³¼ undefined ëª¨ë‘ ì»¤ë²„ (loose equality)
      if (typeof value === 'boolean') return String(value);
      return String(value);                            // íƒ€ì… ì•ˆì „ì„± ë³´ì¥ (v2.5)
    }
  );
}

/** í…œí”Œë¦¿ ë³€ìˆ˜ ì»¨í…ìŠ¤íŠ¸ íƒ€ì… (v2.4) */
type TemplateContext = Record<string, string | boolean | null | undefined>;

/**
 * TipTap HTML entity ë””ì½”ë”© (v2.5)
 * TipTap ì—ë””í„°ê°€ ì¤‘ê´„í˜¸ ë“±ì„ HTML entityë¡œ ë³€í™˜í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ,
 * ë³€ìˆ˜ ì¹˜í™˜ ì „ì— ê´€ë ¨ entityë¥¼ ì›ë³¸ ë¬¸ìë¡œ ë³µì›.
 */
function decodeTemplateEntities(template: string): string {
  return template
    .replace(/&#123;/g, '{')
    .replace(/&#125;/g, '}')
    .replace(/&lcub;/g, '{')
    .replace(/&rcub;/g, '}');
}

/**
 * í…œí”Œë¦¿ ë Œë”ë§ (entity ë””ì½”ë”© â†’ ì¡°ê±´ë¶€ â†’ ë³€ìˆ˜ ìˆœì„œ) (v2.5)
 * v2.8: ì¡°ê±´ë¶€ ë¸”ë¡ ì²˜ë¦¬ í›„ ì”ì—¬ {{/if}} ê°ì§€ â€” íŒŒì‹± ì˜¤ë¥˜ ê°€ëŠ¥ì„± ê²½ê³ 
 */
export function renderTemplate(template: string, context: TemplateContext): string {
  const decoded = decodeTemplateEntities(template);
  const withoutConditionals = processConditionals(decoded, context);

  // v2.8: ì¡°ê±´ë¶€ ì²˜ë¦¬ í›„ ì”ì—¬ ë¸”ë¡ íƒœê·¸ ê°ì§€ (orphaned {{#if}} ë˜ëŠ” {{/if}})
  if (/\{\{#if \w+\}\}/.test(withoutConditionals) || /\{\{\/if\}\}/.test(withoutConditionals)) {
    console.warn('[renderTemplate] ì¡°ê±´ë¶€ ë¸”ë¡ ì²˜ë¦¬ í›„ ì”ì—¬ íƒœê·¸ê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. í…œí”Œë¦¿ êµ¬ì¡°ë¥¼ í™•ì¸í•˜ì„¸ìš”.');
  }

  return replaceVariables(withoutConditionals, context);
}
```

## 2.6 í…œí”Œë¦¿ ì¢…ë¥˜

### ê¸°ë³¸ ì œê³µ í…œí”Œë¦¿ (2ì¢…)

| í…œí”Œë¦¿ | ìš©ë„ | ì œëª© í…œí”Œë¦¿ | í¬í•¨ ë‚´ìš© |
|--------|------|-----------|-----------|
| **ê¸°ë³¸** | ì¼ë°˜ ì¼ì • ê³µìœ  | `[L10n] {updateDateShort} ì—…ë°ì´íŠ¸ ì¼ì • ì•ˆë‚´` | ì¸ì‚¬ë§ + ìƒë‹¨ ë‚ ì§œ + í…Œì´ë¸” + Disclaimer + ì„œëª… |
| **ìƒì„¸** | ê³µì‹ ë°œì‹  | `[L10n] {updateDateShort} ì—…ë°ì´íŠ¸ ì¼ì • ì•ˆë‚´ (ìƒì„¸)` | ì¸ì‚¬ë§ + ë°°ê²½ì„¤ëª…(í•˜ë“œì½”ë”©, v2.5) + ìƒë‹¨ ë‚ ì§œ + í…Œì´ë¸” + Disclaimer + ì£¼ì˜ì‚¬í•­ + ì„œëª… |

> **ê²°ì • (M3, v2.2)**: ê¸°ë³¸ ì œê³µ í…œí”Œë¦¿ì€ í¸ì§‘ ê°€ëŠ¥, ì‚­ì œ ë¶ˆê°€ (í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ 5ëª…ë§Œ)

### "ê¸°ë³¸" í…œí”Œë¦¿ ì „ì²´ HTML

```html
<p style="font-family: Arial, sans-serif; font-size: 14px; color: #333333; line-height: 1.6;">
  ì•ˆë…•í•˜ì„¸ìš”,
</p>

<p style="font-family: Arial, sans-serif; font-size: 14px; color: #333333; line-height: 1.6;">
  ë‹¤ìŒê³¼ ê°™ì´ {updateDate} ì—…ë°ì´íŠ¸ í˜„ì§€í™” ì¼ì •ì„ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.
</p>

<ul style="font-family: Arial, sans-serif; font-size: 14px; color: #333333; line-height: 1.6;">
  <li>â–¡ í—¤ì¦ˆì—…: {headsUp}</li>
  {{#if showIosReviewDate}}<li>â–¡ iOS ì‹¬ì‚¬ì¼: {iosReviewDate}</li>{{/if}}
</ul>

<p style="font-family: Arial, sans-serif; font-size: 16px; font-weight: bold; color: #000000;">
  [ì¼ì •í‘œ]
</p>

{table}

{{#if disclaimer}}
<p style="color: #666666; font-size: 12px; margin-top: 16px;">
  â€» Disclaimer: {disclaimer}
</p>
{{/if}}

<p style="font-family: Arial, sans-serif; font-size: 14px; color: #333333; line-height: 1.6;">
  ë¬¸ì˜ì‚¬í•­ì€ íšŒì‹  ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.
</p>

<p style="font-family: Arial, sans-serif; font-size: 14px; color: #333333; line-height: 1.6;">
  ê°ì‚¬í•©ë‹ˆë‹¤.<br>
  L10níŒ€ ë“œë¦¼
</p>
```

> **v2.5**: Disclaimer ë¸”ë¡ì„ `{{#if disclaimer}}` ì¡°ê±´ë¶€ ë¸”ë¡ìœ¼ë¡œ ê°ìŒˆ â€” ë¹ˆ Disclaimer ì‹œ ë¸”ë¡ ì „ì²´ ìˆ¨ê¹€.

### "ìƒì„¸" í…œí”Œë¦¿ ì „ì²´ HTML

```html
<p style="font-family: Arial, sans-serif; font-size: 14px; color: #333333; line-height: 1.6;">
  ì•ˆë…•í•˜ì„¸ìš”,
</p>

<p style="font-family: Arial, sans-serif; font-size: 14px; color: #333333; line-height: 1.6;">
  {projectName} í”„ë¡œì íŠ¸ì˜ {updateDate} ì—…ë°ì´íŠ¸ í˜„ì§€í™” ì¼ì •ì„ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.
</p>

<p style="font-family: Arial, sans-serif; font-size: 14px; color: #333333; line-height: 1.6; background-color: #f9f9f9; padding: 12px; border-left: 4px solid #0066cc;">
  <strong>[ë°°ê²½ì„¤ëª…]</strong><br>
  ê¸ˆë²ˆ ì—…ë°ì´íŠ¸ëŠ” ì •ê¸° ì½˜í…ì¸  ì—…ë°ì´íŠ¸ì…ë‹ˆë‹¤. í˜„ì§€í™” ì¼ì •ì— ë§ì¶° ë²ˆì—­ ë° ê²€ìˆ˜ë¥¼ ì§„í–‰í•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.
</p>

<ul style="font-family: Arial, sans-serif; font-size: 14px; color: #333333; line-height: 1.6;">
  <li>â–¡ í—¤ì¦ˆì—…: {headsUp}</li>
  {{#if showIosReviewDate}}<li>â–¡ iOS ì‹¬ì‚¬ì¼: {iosReviewDate}</li>{{/if}}
</ul>

<p style="font-family: Arial, sans-serif; font-size: 16px; font-weight: bold; color: #000000;">
  [ì¼ì •í‘œ]
</p>

{table}

{{#if disclaimer}}
<p style="color: #666666; font-size: 12px; margin-top: 16px;">
  â€» Disclaimer: {disclaimer}
</p>
{{/if}}

<p style="font-family: Arial, sans-serif; font-size: 14px; color: #cc0000; line-height: 1.6; background-color: #fff5f5; padding: 12px; border-left: 4px solid #cc0000;">
  <strong>[ì£¼ì˜ì‚¬í•­]</strong><br>
  â€¢ ì¼ì •ì€ ë‚´ë¶€ ì‚¬ì •ì— ë”°ë¼ ë³€ê²½ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
  â€¢ ë³€ê²½ ì‹œ ë³„ë„ ì•ˆë‚´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.<br>
  â€¢ ë¬¸ì˜ì‚¬í•­ì€ L10níŒ€ìœ¼ë¡œ ì—°ë½ ë°”ëë‹ˆë‹¤.
</p>

<p style="font-family: Arial, sans-serif; font-size: 14px; color: #333333; line-height: 1.6;">
  ê°ì‚¬í•©ë‹ˆë‹¤.<br>
  L10níŒ€ ë“œë¦¼
</p>
```

### ì‚¬ìš©ì ì •ì˜ í…œí”Œë¦¿

- ì‚¬ìš©ìê°€ ì§ì ‘ í…œí”Œë¦¿ì„ ì¶”ê°€/ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥ (í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ 5ëª…)
- í…œí”Œë¦¿ ë³€ìˆ˜ (`{updateDate}`, `{table}` ë“±) ì‚¬ìš© ê°€ëŠ¥
- Supabase `email_templates` í…Œì´ë¸”ì— ì €ì¥ (íŒ€ ê³µìœ )

> **ê²°ì • (v2.4)**: ì´ë©”ì¼ í…œí”Œë¦¿ì€ **í”„ë¡œì íŠ¸ë³„**ë¡œ ê´€ë¦¬. ê° í”„ë¡œì íŠ¸ê°€ ë…ë¦½ì ì¸ í…œí”Œë¦¿ ì„¸íŠ¸ë¥¼ ë³´ìœ .
> - `email_templates` í…Œì´ë¸”ì— `project_id` FK ì¶”ê°€
> - ê¸°ë³¸ ì œê³µ í…œí”Œë¦¿(2ì¢…)ì€ **í”„ë¡œì íŠ¸ ìƒì„± ì‹œ ìë™ ë³µì‚¬** (`project_id`ì— ë°”ì¸ë”©)
> - ì´ë¦„ ì¤‘ë³µ ê²€ì‚¬ ë²”ìœ„: ë™ì¼ í”„ë¡œì íŠ¸ ë‚´ (`UNIQUE(project_id, name)`)
> - ì„¤ì • í™”ë©´: ê¸°ì¡´ ì „ì—­ "ì´ë©”ì¼ í…œí”Œë¦¿" íƒ­ â†’ **í”„ë¡œì íŠ¸ ì„ íƒ í›„** í•´ë‹¹ í”„ë¡œì íŠ¸ì˜ í…œí”Œë¦¿ ê´€ë¦¬

### í…œí”Œë¦¿ ê´€ë¦¬ ê·œì¹™ (v2.2)

| í•­ëª© | ê¸°ë³¸ ì œê³µ í…œí”Œë¦¿ | ì‚¬ìš©ì ì •ì˜ í…œí”Œë¦¿ |
|------|-----------------|-------------------|
| **í¸ì§‘** | âœ… ê°€ëŠ¥ (í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸) | âœ… ê°€ëŠ¥ (í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸) |
| **ì‚­ì œ** | âŒ ë¶ˆê°€ | âœ… ê°€ëŠ¥ (í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸) |
| **ì´ë¦„ ìµœëŒ€ ê¸¸ì´** | 50ì | 50ì |
| **ë¹ˆ ë³¸ë¬¸ ì €ì¥** | âœ… í—ˆìš© (ì´ˆì•ˆ ìƒíƒœ) | âœ… í—ˆìš© (ì´ˆì•ˆ ìƒíƒœ) |
| **ì´ë¦„ ì¤‘ë³µ** | âŒ ë¶ˆê°€ (í”„ë¡œì íŠ¸ ë‚´ UNIQUE) | âŒ ë¶ˆê°€ (í”„ë¡œì íŠ¸ ë‚´ UNIQUE) |
| **ì´ˆê¸°í™”(ë¦¬ì…‹)** | âŒ Phase 2 ë²”ìœ„ ì™¸ (v2.5) | N/A |

### í…œí”Œë¦¿ ì´ë¦„ ì¤‘ë³µ ì²˜ë¦¬

> **ê²°ì • (m8, v2.4)**: ì €ì¥ ì‹œ **ë™ì¼ í”„ë¡œì íŠ¸ ë‚´** ì¤‘ë³µ ê²€ì‚¬

| ìƒí™© | ì²˜ë¦¬ |
|------|------|
| ë™ì¼ í”„ë¡œì íŠ¸ ë‚´ ì¤‘ë³µëœ ì´ë¦„ | ì €ì¥ ì‹¤íŒ¨ + ì—ëŸ¬ í† ìŠ¤íŠ¸ "ì´ë¯¸ ì¡´ì¬í•˜ëŠ” í…œí”Œë¦¿ ì´ë¦„ì…ë‹ˆë‹¤" |
| ë‹¤ë¥¸ í”„ë¡œì íŠ¸ì˜ ë™ì¼ ì´ë¦„ | í—ˆìš© (í”„ë¡œì íŠ¸ë³„ ë…ë¦½ ê´€ë¦¬) |

## 2.7 Disclaimer ì²˜ë¦¬

> **ê²°ì • (C4)**: Phase 2ì—ì„œ ê³µí†µ Disclaimer íŒŒì„œ êµ¬í˜„, Phase 3ì—ì„œ ì¬ì‚¬ìš©
>
> **ê²°ì • (v2.5, B3)**: Disclaimerê°€ ë¹ˆ ë¬¸ìì—´(`""`)ì´ê±°ë‚˜ `null`ì´ë©´ `â€» Disclaimer:` ë¼ë²¨ í¬í•¨ **ë¸”ë¡ ì „ì²´ë¥¼ ìˆ¨ê¹€** (`renderDisclaimerHtml` â†’ ë¹ˆ ë¬¸ìì—´ ë°˜í™˜).
> ê¸°ë³¸ ì œê³µ í…œí”Œë¦¿ì˜ `{disclaimer}` ìœ„ì¹˜ì— ë¹ˆ ë¬¸ìì—´ì´ ì‚½ì…ë˜ë¯€ë¡œ `<p>â€» Disclaimer: </p>` íƒœê·¸ë„ ë Œë”ë§ë˜ì§€ ì•ŠìŒ.
> â†’ **êµ¬í˜„**: ê¸°ë³¸ ì œê³µ í…œí”Œë¦¿ì—ì„œ Disclaimer `<p>` ë¸”ë¡ì„ `{{#if disclaimer}}...{{/if}}` ì¡°ê±´ë¶€ ë¸”ë¡ìœ¼ë¡œ ê°ì‹¸ê³ , `disclaimer` ë³€ìˆ˜ë¥¼ ì¡°ê±´ í‰ê°€ì—ë„ ì‚¬ìš©.
>
> **ê³µë°± ì²˜ë¦¬ (v2.6)**: ê³µë°±ë§Œ í¬í•¨ëœ Disclaimer (ì˜ˆ: `"   "`, `" \n "`)ë„ **ë¹ˆ ê°’ìœ¼ë¡œ ì·¨ê¸‰**. `renderDisclaimerHtml` ë‚´ë¶€ì—ì„œ `trim()` + ì»¤ìŠ¤í…€ íƒœê·¸ strip í›„ ë¹ˆ ë¬¸ìì—´ì´ë©´ `null` ë°˜í™˜.

### ê³µí†µ íŒŒì„œ ëª¨ë“ˆ êµ¬ì¡°

```
src/lib/disclaimer/
â”œâ”€ parser.ts          # ì»¤ìŠ¤í…€ íƒœê·¸ íŒŒì‹± (AST ìƒì„±)
â”œâ”€ sanitizer.ts       # XSS ë°©ì§€ (Â§2.7 sanitize í•¨ìˆ˜, UUID ê¸°ë°˜ í”Œë ˆì´ìŠ¤í™€ë”)
â”œâ”€ renderers/
â”‚  â”œâ”€ html.ts         # Phase 2: AST â†’ HTML
â”‚  â””â”€ mrkdwn.ts       # Phase 3: AST â†’ Slack mrkdwn (ì˜ˆì •)
```

### HTML ë³€í™˜ ê·œì¹™ (Phase 2)

| íƒœê·¸ | HTML ë³€í™˜ |
|------|-----------|
| `<b>text</b>` | `<strong>text</strong>` |
| `<r>text</r>` | `<span style="color:red">text</span>` |
| `<g>text</g>` | `<span style="color:green">text</span>` |
| `<bl>text</bl>` | `<span style="color:blue">text</span>` |
| `<u>text</u>` | `<u>text</u>` |
| `\n` | `<br>` |

### XSS ë°©ì§€ ë° íŠ¹ìˆ˜ë¬¸ì ì²˜ë¦¬

> **ê²°ì • (m6)**: ìì²´ sanitizer êµ¬í˜„ (ë‚´ë¶€ 5ì¸ ì‚¬ìš©, ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì…ë ¥)

```typescript
// src/lib/disclaimer/sanitizer.ts

const ALLOWED_TAGS = ['b', 'r', 'g', 'bl', 'u'];

export function sanitize(input: string): string {
  // 1. í—ˆìš©ëœ íƒœê·¸ë¥¼ UUID ê¸°ë°˜ ê³ ìœ  í”Œë ˆì´ìŠ¤í™€ë”ë¡œ êµì²´ (v2.5: ë³´ì•ˆ ê°•í™”)
  //    âš ï¸ ê¸°ì¡´ __OPEN_N__ íŒ¨í„´ì€ ì‚¬ìš©ì ì…ë ¥ì— í¬í•¨ ê°€ëŠ¥ â†’ UUID ì‚¬ìš©ìœ¼ë¡œ ì¶©ëŒ ë°©ì§€
  let result = input;
  const placeholders: Map<string, string> = new Map();

  ALLOWED_TAGS.forEach((tag) => {
    const openRegex = new RegExp(`<${tag}>`, 'gi');
    const closeRegex = new RegExp(`</${tag}>`, 'gi');
    const openPlaceholder = `\u0000OPEN_${crypto.randomUUID()}\u0000`;
    const closePlaceholder = `\u0000CLOSE_${crypto.randomUUID()}\u0000`;

    placeholders.set(openPlaceholder, `<${tag}>`);
    placeholders.set(closePlaceholder, `</${tag}>`);

    result = result.replace(openRegex, openPlaceholder);
    result = result.replace(closeRegex, closePlaceholder);
  });

  // 2. ë‚˜ë¨¸ì§€ HTML íƒœê·¸ ë° íŠ¹ìˆ˜ë¬¸ì escape
  result = result
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#039;');

  // 3. í”Œë ˆì´ìŠ¤í™€ë”ë¥¼ ì›ë˜ íƒœê·¸ë¡œ ë³µì›
  placeholders.forEach((original, placeholder) => {
    result = result.replace(new RegExp(placeholder.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g'), original);
  });

  return result;
}
```

### sanitizer í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ (v2.6, v2.7 ë³´ê°•)

> **âš ï¸ ì•„ë˜ "ê¸°ëŒ€ ì¶œë ¥"ì€ `sanitize()` í•¨ìˆ˜ì˜ ì¶œë ¥**ì…ë‹ˆë‹¤ (íŒŒì´í”„ë¼ì¸ 1ë‹¨ê³„).
> ìµœì¢… ì´ë©”ì¼ HTMLì€ `sanitize â†’ parse â†’ renderHtml` 3ë‹¨ê³„ë¥¼ ê±°ì¹©ë‹ˆë‹¤.
> ì˜ˆ: `sanitize("<b>bold</b>")` â†’ `<b>bold</b>` (sanitizer ì¶œë ¥) â†’ AST â†’ `<strong>bold</strong>` (ìµœì¢… HTML)

| ì…ë ¥ | sanitizer ì¶œë ¥ | ìµœì¢… HTML (ì°¸ê³ ) | ê²€ì¦ í¬ì¸íŠ¸ |
|------|---------------|-----------------|-------------|
| `<b>bold</b>` | `<b>bold</b>` | `<strong>bold</strong>` | í—ˆìš© íƒœê·¸ ë³´ì¡´ â†’ HTML ë³€í™˜ |
| `<script>alert(1)</script>` | `&lt;script&gt;alert(1)&lt;/script&gt;` | ê·¸ëŒ€ë¡œ (í…ìŠ¤íŠ¸) | ë¹„í—ˆìš© íƒœê·¸ escape |
| `<b>bold<script>xss</script></b>` | `<b>bold&lt;script&gt;xss&lt;/script&gt;</b>` | `<strong>bold&lt;script&gt;...&lt;/script&gt;</strong>` | í˜¼í•© ì²˜ë¦¬ |
| `<r>red & blue</r>` | `<r>red &amp; blue</r>` | `<span style="color:red">red &amp; blue</span>` | í—ˆìš© íƒœê·¸ ë‚´ & escape |
| `\u0000OPEN_...` | escape ì²˜ë¦¬ | escape ì²˜ë¦¬ | null byte í”Œë ˆì´ìŠ¤í™€ë” ì¶©ëŒ ë°©ì§€ |
| `<B>UPPER</B>` | `<B>UPPER</B>` | `<strong>UPPER</strong>` | ëŒ€ì†Œë¬¸ì ë¬´ê´€ (`gi` flag) |
| (ë¹ˆ ë¬¸ìì—´) | (ë¹ˆ ë¬¸ìì—´) | (ë¹ˆ ë¬¸ìì—´) | ë¹ˆ ì…ë ¥ ì²˜ë¦¬ |

## 2.8 í”Œë ˆì¸í…ìŠ¤íŠ¸ ë³€í™˜ ê·œì¹™

> **ê²°ì • (M5)**: ë‹¨ìˆœ íƒœê·¸ ì œê±°

| HTML | í”Œë ˆì¸í…ìŠ¤íŠ¸ |
|------|-------------|
| `<p>text</p>` | `text\n\n` |
| `<br>` | `\n` |
| `<li>item</li>` | `â€¢ item\n` |
| `<strong>text</strong>` | `text` (íƒœê·¸ë§Œ ì œê±°) |
| `<a href="url">text</a>` | `text` (ë§í¬ í…ìŠ¤íŠ¸ë§Œ ë³´ì¡´, URL ì œê±° â€” v2.7) |
| `<table>...</table>` | í–‰ë³„: ì…€ ë‚´ìš©ì„ íƒ­(`\t`) êµ¬ë¶„, í–‰ ê°„ ì¤„ë°”ê¿ˆ(`\n`). í—¤ë”í–‰ í¬í•¨. (v2.5) v2.8: `colspan`/`rowspan` ì…€ì€ ë‹¨ìˆœ í…ìŠ¤íŠ¸ ì¶”ì¶œ (ë³‘í•© ë¬´ì‹œ), ë¹ˆ ì…€ì€ ë¹ˆ ë¬¸ìì—´ (`\t\t`ë¡œ í‘œí˜„) |
| inline style ì†ì„± í¬í•¨ íƒœê·¸ | íƒœê·¸ì™€ ì†ì„± ëª¨ë‘ ì œê±° (í…ìŠ¤íŠ¸ë§Œ ë³´ì¡´) (v2.5) |
| HTML entities (`&amp;`) | ì›ë³¸ ë¬¸ì (`&`) |
| ë¹ˆ `<table>` (í–‰ ì—†ìŒ) | ë¹ˆ ë¬¸ìì—´ (v2.8: í—¤ë”ë§Œ ìˆëŠ” í…Œì´ë¸”ë„ í—¤ë”í–‰ ì¶œë ¥) |

---

# 3. UI í”Œë¡œìš°

## 3.1 ë²„íŠ¼ ìœ„ì¹˜

> **ê²°ì • (v2.3)**: ì•¡ì…˜ ë°”ì— 4ê°œ ë²„íŠ¼ì„ í”Œë«í•˜ê²Œ ë‚˜ì—´. `[ì´ë©”ì¼ ë³µì‚¬]` = ëª¨ë‹¬ì„ ì—´ì–´ í…œí”Œë¦¿ ì„ íƒÂ·ë¯¸ë¦¬ë³´ê¸° í›„ ë³µì‚¬í•˜ëŠ” ë‹¨ì¼ ì§„ì…ì . ~~`[ì´ë©”ì¼ ìƒì„±]`~~ ë²„íŠ¼ì€ ì œê±° (ì—­í•  ì¤‘ë³µ).

**ìƒë‹¨ ì•¡ì…˜ ë°”** ë ˆì´ì•„ì›ƒ:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ M4/GL â–¼                                                    [âš™ï¸] [ë¡œê·¸ì•„ì›ƒ]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  ì—…ë°ì´íŠ¸ì¼: 2026-02-10 (ì›”)                                                â”‚
â”‚  [ê³„ì‚°]  [í…Œì´ë¸” ë³µì‚¬]  [ì´ë¯¸ì§€ ë³µì‚¬]  [ì´ë©”ì¼ ë³µì‚¬]                         â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| ë²„íŠ¼ | ìŠ¤íƒ€ì¼ | ë™ì‘ |
|------|--------|------|
| **[ê³„ì‚°]** | Primary | ì¼ì • ê³„ì‚° ì‹¤í–‰ |
| **[í…Œì´ë¸” ë³µì‚¬]** | Secondary (outline) | í˜„ì¬ í…Œì´ë¸” HTML í´ë¦½ë³´ë“œ ë³µì‚¬ |
| **[ì´ë¯¸ì§€ ë³µì‚¬]** | Secondary (outline) | html2canvas â†’ ì´ë¯¸ì§€ í´ë¦½ë³´ë“œ ë³µì‚¬ |
| **[ì´ë©”ì¼ ë³µì‚¬]** | Primary | ì´ë©”ì¼ ë³µì‚¬ ëª¨ë‹¬ ì—´ê¸° â†’ í…œí”Œë¦¿ ì„ íƒÂ·ë¯¸ë¦¬ë³´ê¸° â†’ í´ë¦½ë³´ë“œ ë³µì‚¬ |

### ë²„íŠ¼ í™œì„±í™” ì¡°ê±´

| ìƒíƒœ | [ê³„ì‚°] | [í…Œì´ë¸” ë³µì‚¬] | [ì´ë¯¸ì§€ ë³µì‚¬] | [ì´ë©”ì¼ ë³µì‚¬] |
|------|--------|-------------|-------------|-------------|
| ê³„ì‚° ê²°ê³¼ ì—†ìŒ | í™œì„±í™” | ë¹„í™œì„±í™” | ë¹„í™œì„±í™” | ë¹„í™œì„±í™” |
| ê³„ì‚° ê²°ê³¼ ìˆìŒ | í™œì„±í™” | í™œì„±í™” | í™œì„±í™” | í™œì„±í™” |

> **"ê³„ì‚° ê²°ê³¼ ìˆìŒ" ì •ì˜ (v2.4)**: `calculationResult !== null` â€” í˜„ì¬ í”„ë¡œì íŠ¸ + í˜„ì¬ ì—…ë°ì´íŠ¸ ë‚ ì§œì— ëŒ€í•œ `CalculationResult` ë ˆì½”ë“œê°€ Supabaseì— ì¡´ì¬í•˜ëŠ” ìƒíƒœ.

### ëª¨ë‹¬ ì´ˆê¸° ì„ íƒê°’

> **ê²°ì • (M10)**: ê³ ì • ê¸°ë³¸ê°’ ì‚¬ìš©

| í•­ëª© | ê¸°ë³¸ê°’ |
|------|--------|
| í…Œì´ë¸” | **T2 (Ext. ì™¸ë¶€ìš©)** - ê°€ì¥ ë¹ˆë²ˆí•œ ì‚¬ìš© ì¼€ì´ìŠ¤ |
| í…œí”Œë¦¿ | **"ê¸°ë³¸"** í…œí”Œë¦¿ |

## 3.2 í”Œë¡œìš°

> **ê²°ì • (v2.3)**: `[ì´ë©”ì¼ ë³µì‚¬]` ë²„íŠ¼ = ìœ ì¼í•œ ì´ë©”ì¼ ì§„ì…ì . ë³¸ë¬¸ë§Œ í´ë¦½ë³´ë“œ ë³µì‚¬, ì œëª©ì€ ë¯¸ë¦¬ë³´ê¸°ì—ì„œ í´ë¦­í•˜ì—¬ ë³„ë„ ë³µì‚¬.

```
[ì´ë©”ì¼ ë³µì‚¬] ë²„íŠ¼ í´ë¦­
  â†“
[ì´ë©”ì¼ ë³µì‚¬ ëª¨ë‹¬] (ì´ˆê¸°ê°’: T2, ê¸°ë³¸ í…œí”Œë¦¿)
  â”œâ”€ í…Œì´ë¸” ì„ íƒ: â—‹ T1(ë‚´ë¶€) â— T2(Ext.) â—‹ T3(Int.)
  â”œâ”€ í…œí”Œë¦¿ ì„ íƒ: â— ê¸°ë³¸ â—‹ ìƒì„¸ â—‹ ì‚¬ìš©ì ì •ì˜ â–¼ (ë“œë¡­ë‹¤ìš´)
  â”œâ”€ ë¯¸ë¦¬ë³´ê¸° ì˜ì—­ (ì‹¤ì‹œê°„ ê°±ì‹ )
  â”‚   â””â”€ ì œëª© ì˜ì—­: í´ë¦­ ì‹œ navigator.clipboard.writeText()ë¡œ plain text ë³µì‚¬ (v2.4)
  â”‚       â”œâ”€ ì„±ê³µ â†’ "ì œëª©ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤" í† ìŠ¤íŠ¸
  â”‚       â””â”€ ì‹¤íŒ¨ â†’ "ì œëª© ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤" ì—ëŸ¬ í† ìŠ¤íŠ¸
  â””â”€ í•˜ë‹¨ ë²„íŠ¼: [ì·¨ì†Œ] [í´ë¦½ë³´ë“œ ë³µì‚¬]
  â†“
[í´ë¦½ë³´ë“œ ë³µì‚¬] í´ë¦­ â†’ ë³¸ë¬¸(HTML + plain text)ë§Œ ë³µì‚¬
  â†“
"í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤" í† ìŠ¤íŠ¸ ë©”ì‹œì§€ â†’ **ëª¨ë‹¬ ìœ ì§€** (v2.4: ë‹¤ë¥¸ í…Œì´ë¸”/í…œí”Œë¦¿ìœ¼ë¡œ ì¬ë³µì‚¬ ê°€ëŠ¥)
  â†“
Gmail/ì•„ì›ƒë£©ì— ë¶™ì—¬ë„£ê¸° (ì œëª©ì€ ìˆ˜ë™ ì…ë ¥ ë˜ëŠ” ë³„ë„ ë³µì‚¬ëœ ê°’ ì‚¬ìš©)
```

## 3.3 ëª¨ë‹¬ UI ìƒì„¸

> **ê²°ì • (M11)**: ë¼ë””ì˜¤ ë²„íŠ¼ 3ê°œ + ì‚¬ìš©ì ì •ì˜ ì„ íƒ ì‹œ ë“œë¡­ë‹¤ìš´ í™•ì¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì´ë©”ì¼ ë³µì‚¬                                               [âœ•]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ í…Œì´ë¸” ì„ íƒ                                                     â”‚
â”‚ â—‹ í…Œì´ë¸” 1 (ë‚´ë¶€ ì¼ì •í‘œ)                                        â”‚
â”‚ â— í…Œì´ë¸” 2 (Ext. ì™¸ë¶€ìš©)          â† ê¸°ë³¸ ì„ íƒ                   â”‚
â”‚ â—‹ í…Œì´ë¸” 3 (Int. ë‚´ë¶€ìš©)                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ í…œí”Œë¦¿ ì„ íƒ                        (ë¡œë”© ì¤‘: ìŠ¤í”¼ë„ˆ í‘œì‹œ â€” v2.5)  â”‚
â”‚ â— ê¸°ë³¸  â—‹ ìƒì„¸  â—‹ ì‚¬ìš©ì ì •ì˜                                   â”‚
â”‚                   â””â”€ [ì‚¬ìš©ì ì •ì˜ ì„ íƒ ì‹œ ë“œë¡­ë‹¤ìš´ í‘œì‹œ]        â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚                      â”‚ ë‚´ í…œí”Œë¦¿ 1       â–¼ â”‚                   â”‚
â”‚                      â”‚ ë‚´ í…œí”Œë¦¿ 2         â”‚                   â”‚
â”‚                      â”‚ í”„ë¡œì íŠ¸ìš© í…œí”Œë¦¿   â”‚                   â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                      (ì •ë ¬ ìˆœì„œ â€” v2.7:                        â”‚
â”‚                       built-in ë¨¼ì € â†’ ì‚¬ìš©ì ì •ì˜               â”‚
â”‚                       ì‚¬ìš©ì ì •ì˜ëŠ” created_at DESC ì •ë ¬)       â”‚
â”‚                      (ì‚¬ìš©ì ì •ì˜ í…œí”Œë¦¿ 0ê°œ:                  â”‚
â”‚                       ë¼ë””ì˜¤ ë¹„í™œì„±í™”(disabled) + íˆ´íŒ:         â”‚
â”‚                       "ì‚¬ìš©ì ì •ì˜ í…œí”Œë¦¿ì´ ì—†ìŠµë‹ˆë‹¤.           â”‚
â”‚                        ì„¤ì •ì—ì„œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.")    v2.6   â”‚
â”‚                      (í…œí”Œë¦¿ ë¯¸ì„ íƒ ì‹œ:                         â”‚
â”‚                       ë¯¸ë¦¬ë³´ê¸° = "í…œí”Œë¦¿ì„ ì„ íƒí•´ì£¼ì„¸ìš”")  v2.5 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ë¯¸ë¦¬ë³´ê¸°                                           [HTML ë³´ê¸°]  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ì œëª©: [L10n] 02-10 ì—…ë°ì´íŠ¸ ì¼ì • ì•ˆë‚´  [ğŸ“‹ í´ë¦­ ë³µì‚¬]       â”‚ â”‚
â”‚ â”‚                                                             â”‚ â”‚
â”‚ â”‚ ì•ˆë…•í•˜ì„¸ìš”,                                                 â”‚ â”‚
â”‚ â”‚                                                             â”‚ â”‚
â”‚ â”‚ ë‹¤ìŒê³¼ ê°™ì´ 02/10(ì›”) ì—…ë°ì´íŠ¸ í˜„ì§€í™” ì¼ì •ì„...             â”‚ â”‚
â”‚ â”‚                                                             â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚ â”‚
â”‚ â”‚ â”‚ #  â”‚  ë°°ì¹˜  â”‚     HO       â”‚     HB       â”‚  ì„¤ëª…  â”‚      â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚ â”‚
â”‚ â”‚ â”‚ 1  â”‚  ì •ê¸°  â”‚ 01/10(ê¸ˆ)... â”‚ 01/15(ìˆ˜)... â”‚        â”‚      â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ â”‚
â”‚ â”‚ ...                                                         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                    [ì·¨ì†Œ]  [í´ë¦½ë³´ë“œ ë³µì‚¬]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> **[HTML ë³´ê¸°] í† ê¸€ ë²„íŠ¼**: ë¯¸ë¦¬ë³´ê¸°(ë Œë”ë§) â†” HTML ì†ŒìŠ¤ ì „í™˜ (ë‚´ë¶€ ìƒíƒœ: `showHtmlSource: boolean`, ê¸°ë³¸ê°’ `false` â€” v2.5)
> - ë²„íŠ¼ ë¼ë²¨: `showHtmlSource ? "ë¯¸ë¦¬ë³´ê¸°" : "HTML ë³´ê¸°"` (v2.6)
> - HTML ì†ŒìŠ¤ í‘œì‹œ ì‹œ: juice ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ ë³€í™˜ í›„ì˜ ìµœì¢… HTML í‘œì‹œ (v2.6)

---

# 4. ê¸°ìˆ  êµ¬í˜„

## 4.1 ë°ì´í„° êµ¬ì¡°

```typescript
// âš ï¸ Supabase Row(snake_case) â†’ í”„ë¡ íŠ¸ì—”ë“œ(camelCase) ë³€í™˜ í•„ìš”. Â§4.3 supabase.ts Row íƒ€ì… ì°¸ì¡°.
interface EmailTemplate {
  id: string;                    // UUID (ê¸°ë³¸ ì œê³µ ë° ì‚¬ìš©ì ì •ì˜ ëª¨ë‘ UUID í˜•ì‹)
  projectId: string;             // ì†Œì† í”„ë¡œì íŠ¸ ID (v2.4: í”„ë¡œì íŠ¸ë³„ ê´€ë¦¬)
  name: string;                  // í…œí”Œë¦¿ ì´ë¦„ (í”„ë¡œì íŠ¸ ë‚´ UNIQUE)
  subjectTemplate: string;       // ì œëª© í…œí”Œë¦¿
  bodyTemplate: string;          // ë³¸ë¬¸ í…œí”Œë¦¿ (HTML)
  isBuiltIn: boolean;            // ê¸°ë³¸ ì œê³µ í…œí”Œë¦¿ ì—¬ë¶€
  createdAt: string;             // ISO 8601 ë¬¸ìì—´ (v2.4: non-optional, DB DEFAULT). âš ï¸ Date ê°ì²´ ì•„ë‹˜ â€” Supabase JSON ì‘ë‹µì€ í•­ìƒ string ë°˜í™˜ (v2.7)
  createdBy: string | null;      // ìƒì„±ì ì´ë©”ì¼ (SYSTEM ë˜ëŠ” ì‚¬ìš©ì)
  updatedAt: string;             // ISO 8601 ë¬¸ìì—´ (v2.4: non-optional, DB DEFAULT). âš ï¸ Date ë³€í™˜ í•„ìš” ì‹œ new Date(updatedAt) ì‚¬ìš© (v2.7)
}

interface EmailGenerationRequest {
  projectId: string;
  updateDate: Date;
  tableType: 'table1' | 'table2' | 'table3';
  templateId: string;            // ê¸°ë³¸ ì œê³µ ë˜ëŠ” ì‚¬ìš©ì ì •ì˜ í…œí”Œë¦¿ ID
}

interface EmailGenerationResult {
  subject: string;               // ìƒì„±ëœ ì œëª©
  bodyHtml: string;              // ìƒì„±ëœ ë³¸ë¬¸ (HTML)
  bodyText: string;              // ìƒì„±ëœ ë³¸ë¬¸ (í”Œë ˆì¸í…ìŠ¤íŠ¸)
}
```

## 4.2 Supabase í…Œì´ë¸”: email_templates

```sql
CREATE TABLE email_templates (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  project_id TEXT NOT NULL REFERENCES projects(id) ON DELETE CASCADE,  -- v2.4: í”„ë¡œì íŠ¸ë³„ ê´€ë¦¬
  name TEXT NOT NULL,
  subject_template TEXT NOT NULL,
  body_template TEXT NOT NULL,
  is_built_in BOOLEAN NOT NULL DEFAULT false,  -- v2.8: NOT NULL ì¶”ê°€ (boolean ì»¬ëŸ¼ì— null ë°©ì§€)
  created_at TIMESTAMPTZ DEFAULT NOW(),
  created_by TEXT,
  updated_at TIMESTAMPTZ DEFAULT NOW()  -- ì¶”ê°€ (m3)
);

-- v2.4: í”„ë¡œì íŠ¸ ë‚´ ì´ë¦„ ì¤‘ë³µ ë°©ì§€ (ê¸°ì¡´ name UNIQUE â†’ project_id + name UNIQUE)
ALTER TABLE email_templates ADD CONSTRAINT uq_email_templates_project_name UNIQUE (project_id, name);

-- ì´ë¦„ ê¸¸ì´ ì œí•œ (v2.2)
ALTER TABLE email_templates ADD CONSTRAINT chk_name_length CHECK (char_length(name) <= 50);

-- updated_at ìë™ ê°±ì‹  íŠ¸ë¦¬ê±° (m3)
-- âš ï¸ ì˜ì¡´ì„±: update_updated_at_column() í•¨ìˆ˜ëŠ” ê¸°ì¡´ ë§ˆì´ê·¸ë ˆì´ì…˜(001)ì—ì„œ ìƒì„±ë¨.
--    ì´ íŠ¸ë¦¬ê±°ëŠ” í•´ë‹¹ í•¨ìˆ˜ê°€ ì¡´ì¬í•´ì•¼ ë™ì‘í•©ë‹ˆë‹¤.
CREATE TRIGGER update_email_templates_updated_at
  BEFORE UPDATE ON email_templates
  FOR EACH ROW
  EXECUTE FUNCTION update_updated_at_column();

-- v2.4: ê¸°ë³¸ ì œê³µ í…œí”Œë¦¿ì€ í”„ë¡œì íŠ¸ ìƒì„± ì‹œ ìë™ ë³µì‚¬ (ì•„ë˜ í•¨ìˆ˜ ì°¸ì¡°)
-- ê³ ì • UUID INSERTëŠ” ì œê±°. í”„ë¡œì íŠ¸ë³„ë¡œ ë™ì  ìƒì„±ë¨.

-- RLS ì •ì±… (m2: ê¸°ì¡´ íŒ¨í„´ì— ë§ê²Œ ë¶„ë¦¬)
-- âš ï¸ auth.email() íŒ¨í„´: ê¸°ì¡´ í”„ë¡œì íŠ¸ì˜ RLS ì •ì±…(001 ë§ˆì´ê·¸ë ˆì´ì…˜ ë“±)ê³¼ ë™ì¼í•œ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ íŒ¨í„´ ì‚¬ìš©.
--    í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ë³€ê²½ ì‹œ ëª¨ë“  í…Œì´ë¸”ì˜ RLS ì •ì±…ì„ í•¨ê»˜ ê°±ì‹ í•´ì•¼ í•©ë‹ˆë‹¤.
ALTER TABLE email_templates ENABLE ROW LEVEL SECURITY;

-- ì½ê¸°: ì¸ì¦ëœ ì‚¬ìš©ì ì „ì²´
CREATE POLICY "Authenticated users can read email_templates"
  ON email_templates FOR SELECT
  USING (auth.role() = 'authenticated');

-- ì“°ê¸° (INSERT): í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸
CREATE POLICY "Whitelisted users can insert email_templates"
  ON email_templates FOR INSERT
  WITH CHECK (auth.email() IN (
    'jkcho@wemade.com', 'mine@wemade.com', 'srpark@wemade.com',
    'garden0130@wemade.com', 'hkkim@wemade.com'
  ));

-- ìˆ˜ì • (UPDATE): í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ (ê¸°ë³¸ í…œí”Œë¦¿ í¬í•¨ - M3)
CREATE POLICY "Whitelisted users can update email_templates"
  ON email_templates FOR UPDATE
  USING (auth.email() IN (
    'jkcho@wemade.com', 'mine@wemade.com', 'srpark@wemade.com',
    'garden0130@wemade.com', 'hkkim@wemade.com'
  ));

-- ì‚­ì œ (DELETE): í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ + ê¸°ë³¸ ì œê³µ í…œí”Œë¦¿ ì‚­ì œ ë¶ˆê°€ (v2.2)
CREATE POLICY "Whitelisted users can delete custom email_templates"
  ON email_templates FOR DELETE
  USING (
    auth.email() IN (
      'jkcho@wemade.com', 'mine@wemade.com', 'srpark@wemade.com',
      'garden0130@wemade.com', 'hkkim@wemade.com'
    )
    AND is_built_in = false
  );

-- ì¸ë±ìŠ¤
CREATE INDEX idx_email_templates_project_id ON email_templates(project_id); -- v2.4
CREATE INDEX idx_email_templates_is_built_in ON email_templates(is_built_in);
CREATE INDEX idx_email_templates_created_by ON email_templates(created_by);
```

> **is_built_in ë³´í˜¸ ì „ëµ (v2.7)**:
> - **DB ë ˆë²¨**: RLS DELETE policyì—ì„œ `is_built_in = false` ì¡°ê±´ìœ¼ë¡œ ì‚­ì œ ì°¨ë‹¨.
> - **TypeScript ë ˆë²¨**: `deleteEmailTemplate()` í˜¸ì¶œ ì „ `template.isBuiltIn === false` ì‚¬ì „ ê²€ì¦.
>   UIì—ì„œ ê¸°ë³¸ ì œê³µ í…œí”Œë¦¿ì˜ ì‚­ì œ ë²„íŠ¼ì„ ìˆ¨ê¸°ë¯€ë¡œ ì´ì¤‘ ë°©ì–´.
> - **UPDATE**: `is_built_in` í•„ë“œëŠ” Insert/Update íƒ€ì…ì— í¬í•¨ë˜ì§€ ì•Šì•„ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ë³€ê²½ ë¶ˆê°€ (Â§4.3 supabase.ts ì°¸ì¡°).

### í”„ë¡œì íŠ¸ ìƒì„± ì‹œ ê¸°ë³¸ ì œê³µ í…œí”Œë¦¿(2ì¢…) ìë™ ë³µì‚¬ (v2.4)

> **ê²°ì • (v2.4)**: í”„ë¡œì íŠ¸ ìƒì„± ì‹œ ê¸°ë³¸ ì œê³µ í…œí”Œë¦¿ 2ì¢…ì„ í•´ë‹¹ í”„ë¡œì íŠ¸ì— ìë™ ì‚½ì…í•˜ëŠ” DB íŠ¸ë¦¬ê±° í•¨ìˆ˜.
> ìì„¸í•œ SQLì€ **Â§6 ë§ˆì´ê·¸ë ˆì´ì…˜ 006_phase2_email_templates.sql** ì°¸ì¡°.
> âš ï¸ Â§4.2ì˜ DDLê³¼ Â§6ì˜ ë§ˆì´ê·¸ë ˆì´ì…˜ SQLì€ **ë™ì¼ ìŠ¤í‚¤ë§ˆ**ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. Â§4.2ëŠ” ë…¼ë¦¬ êµ¬ì¡° ì°¸ì¡°ìš©, Â§6ì€ ì‹¤ì œ ì‹¤í–‰ SQLì…ë‹ˆë‹¤.
>
> **íŠ¸ë¦¬ê±° ì‹¤íŒ¨ ë™ì‘ (v2.5, v2.6 ë³´ê°•)**: `seed_email_templates_for_project()` ì‹¤í–‰ ì¤‘ ì—ëŸ¬ ë°œìƒ ì‹œ PostgreSQL ê¸°ë³¸ ë™ì‘ì— ë”°ë¼ **í”„ë¡œì íŠ¸ INSERTë„ ë¡¤ë°±**ë¨ (íŠ¸ë¦¬ê±°ëŠ” ë™ì¼ íŠ¸ëœì­ì…˜ ë‚´ ì‹¤í–‰). ì´ëŠ” ì˜ë„ëœ ë™ì‘ â€” í…œí”Œë¦¿ ì—†ëŠ” í”„ë¡œì íŠ¸ ìƒì„± ë°©ì§€.
> - **ì—ëŸ¬ ë©”ì‹œì§€ (v2.6)**: `"ê¸°ë³¸ ì´ë©”ì¼ í…œí”Œë¦¿ ìƒì„± ì‹¤íŒ¨ (project_id: {id}). ì›ì¸: {SQLERRM} â€” í”„ë¡œì íŠ¸ ìƒì„±ì´ ë¡¤ë°±ë©ë‹ˆë‹¤. ì¬ì‹œë„í•˜ê±°ë‚˜ DB ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”."` (Â§6 EXCEPTION ë¸”ë¡ ì°¸ì¡°)
> - **í”„ë¡ íŠ¸ì—”ë“œ ì²˜ë¦¬**: í”„ë¡œì íŠ¸ ìƒì„± API ì—ëŸ¬ ì‹œ ì—ëŸ¬ í† ìŠ¤íŠ¸ í‘œì‹œ + ì¬ì‹œë„ ì•ˆë‚´
> - `SECURITY DEFINER`ë¡œ ì‹¤í–‰í•˜ì—¬ RLS INSERT policyë¥¼ ìš°íšŒí•¨ (ìƒì„¸ SQL: Â§6 ì°¸ì¡°).

## 4.3 ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°

```
src/components/
â”œâ”€ EmailGeneratorModal.tsx       # ì´ë©”ì¼ ë³µì‚¬ ëª¨ë‹¬ (ì•„ë˜ props ì°¸ì¡°)
â”œâ”€ EmailPreview.tsx              # ì´ë©”ì¼ ë¯¸ë¦¬ë³´ê¸° (HTML ë³´ê¸° í† ê¸€ ê¸°ëŠ¥ í¬í•¨)
â”œâ”€ EmailTemplateSelector.tsx     # í…œí”Œë¦¿ ì„ íƒ UI (ë¼ë””ì˜¤ + ë“œë¡­ë‹¤ìš´)
â”œâ”€ EmailTemplateEditor.tsx       # í…œí”Œë¦¿ í¸ì§‘ UI (TipTap WYSIWYG ì—ë””í„°)
â””â”€ EmailTemplateEditModal.tsx    # í…œí”Œë¦¿ í¸ì§‘ ëª¨ë‹¬ (M2: ë³„ë„ ëª¨ë‹¬)

src/lib/email/
â”œâ”€ templates.ts                  # ê¸°ë³¸ í…œí”Œë¦¿ ì •ì˜ (2ì¢…)
â”œâ”€ generator.ts                  # ì´ë©”ì¼ ìƒì„± ë¡œì§ + formatEmailDate, formatUpdateDateShort
â”œâ”€ templateParser.ts             # í…œí”Œë¦¿ íŒŒì„œ (ì¡°ê±´ë¶€ + ë³€ìˆ˜)
â”œâ”€ tableFormatter.ts             # í…Œì´ë¸” HTML ë³€í™˜ (getEntriesByTableType, formatTableHtml)
â”œâ”€ htmlToPlainText.ts            # HTML â†’ í”Œë ˆì¸í…ìŠ¤íŠ¸ ë³€í™˜
â”œâ”€ inlineStyles.ts               # juice ê¸°ë°˜ inline ìŠ¤íƒ€ì¼ ë³€í™˜
â””â”€ clipboard.ts                  # í´ë¦½ë³´ë“œ ë³µì‚¬ (HTML + í…ìŠ¤íŠ¸)

src/lib/disclaimer/              # ê³µí†µ Disclaimer íŒŒì„œ (C4)
â”œâ”€ parser.ts                     # ì»¤ìŠ¤í…€ íƒœê·¸ íŒŒì‹±
â”œâ”€ sanitizer.ts                  # XSS ë°©ì§€
â””â”€ renderers/
   â”œâ”€ html.ts                    # Phase 2: HTML ë³€í™˜
   â””â”€ mrkdwn.ts                  # Phase 3: Slack ë³€í™˜ (ì˜ˆì •)

src/lib/api/
â”œâ”€ emailTemplates.ts             # í…œí”Œë¦¿ CRUD API

src/lib/
â”œâ”€ supabase.ts                   # âš ï¸ Database ì¸í„°í˜ì´ìŠ¤ì— email_templates íƒ€ì… ì¶”ê°€ (ì•„ë˜ v2.3 ëª…ì„¸ ì°¸ì¡°)

src/hooks/
â”œâ”€ useEmailTemplates.ts          # React Query í›…
```

### supabase.ts Database íƒ€ì… í™•ì¥ (v2.3)

> ê¸°ì¡´ `src/lib/supabase.ts`ì˜ `Database` ì¸í„°í˜ì´ìŠ¤ì— ì•„ë˜ í…Œì´ë¸” ì •ì˜ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
> âš ï¸ v2.8: ê¸°ì¡´ í…Œì´ë¸”(projects, work_stages, schedule_entries ë“±)ì˜ Database íƒ€ì…ì€ ì´ë¯¸ supabase.tsì— ì •ì˜ë˜ì–´ ìˆìœ¼ë©°, ë³¸ ë¬¸ì„œì—ì„œëŠ” email_templates ì¶”ê°€ë¶„ë§Œ ëª…ì„¸í•©ë‹ˆë‹¤.

```typescript
// Database['public']['Tables'] ì— ì¶”ê°€
email_templates: {
  Row: {
    id: string;
    project_id: string;            // v2.4: í”„ë¡œì íŠ¸ FK
    name: string;
    subject_template: string;
    body_template: string;
    is_built_in: boolean;
    created_at: string;
    created_by: string | null;
    updated_at: string;
  };
  Insert: {
    id?: string;
    project_id: string;            // v2.4: í•„ìˆ˜
    name: string;
    subject_template: string;
    body_template: string;
    is_built_in?: boolean;         // âš ï¸ v2.8: seed íŠ¸ë¦¬ê±° ì „ìš©. í”„ë¡ íŠ¸ì—”ë“œì—ì„œ trueë¡œ ì„¤ì • ê¸ˆì§€ â€” ê¸°ë³¸ ì œê³µ í…œí”Œë¦¿ì€ DB íŠ¸ë¦¬ê±°ë§Œ ìƒì„±
    created_by?: string | null;    // v2.6: null í—ˆìš© (seed íŠ¸ë¦¬ê±°ëŠ” 'SYSTEM', ì‚¬ìš©ì ìƒì„± ì‹œ ì´ë©”ì¼ ë˜ëŠ” null)
  };
  Update: {
    name?: string;
    subject_template?: string;
    body_template?: string;
  };
};
```

### EmailPreview Props (v2.6)

```typescript
interface EmailPreviewProps {
  subject: string;                      // ë Œë”ë§ëœ ì œëª©
  bodyHtml: string;                     // ë Œë”ë§ëœ ë³¸ë¬¸ HTML (juice ë³€í™˜ í›„)
  showHtmlSource: boolean;              // HTML ì†ŒìŠ¤ ë³´ê¸° ìƒíƒœ
  onToggleHtmlSource: () => void;       // HTML ë³´ê¸° í† ê¸€ í•¸ë“¤ëŸ¬
  onCopySubject: () => void;            // ì œëª© ë³µì‚¬ í•¸ë“¤ëŸ¬
}
```

### EmailTemplateSelector Props (v2.6)

```typescript
interface EmailTemplateSelectorProps {
  templates: EmailTemplate[];            // í”„ë¡œì íŠ¸ì˜ ì „ì²´ í…œí”Œë¦¿ ëª©ë¡
  selectedTemplateId: string | null;     // í˜„ì¬ ì„ íƒëœ í…œí”Œë¦¿ ID
  onSelect: (templateId: string) => void;
  isLoading: boolean;                    // í…œí”Œë¦¿ ë¡œë”© ì¤‘ ì—¬ë¶€ (ìŠ¤í”¼ë„ˆ í‘œì‹œ)
  hasCustomTemplates: boolean;           // ì‚¬ìš©ì ì •ì˜ í…œí”Œë¦¿ ì¡´ì¬ ì—¬ë¶€ (falseë©´ ë¼ë””ì˜¤ ë¹„í™œì„±í™”)
}
// v2.7: "ì‚¬ìš©ì ì •ì˜" ë¼ë””ì˜¤ ì„ íƒ ì‹œ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°ê°’ = ì²« ë²ˆì§¸ ì‚¬ìš©ì ì •ì˜ í…œí”Œë¦¿ ìë™ ì„ íƒ
//       (ëª©ë¡ì´ created_at DESCì´ë¯€ë¡œ ê°€ì¥ ìµœê·¼ ìƒì„±ëœ í…œí”Œë¦¿)

// v2.8: ë¼ë””ì˜¤ â†’ í…œí”Œë¦¿ ID ë§¤í•‘ ë¡œì§
// ë¼ë””ì˜¤ ì¹´í…Œê³ ë¦¬ íƒ€ì…
type TemplateCategory = 'basic' | 'detailed' | 'custom';
// ì¹´í…Œê³ ë¦¬ ì„ íƒ â†’ selectedTemplateId ë³€í™˜:
//   'basic'    â†’ templates.find(t => t.isBuiltIn && t.name === 'ê¸°ë³¸')?.id
//   'detailed' â†’ templates.find(t => t.isBuiltIn && t.name === 'ìƒì„¸')?.id
//   'custom'   â†’ ë“œë¡­ë‹¤ìš´ì—ì„œ ì„ íƒí•œ ì‚¬ìš©ì ì •ì˜ í…œí”Œë¦¿ ID
```

### EmailTemplateEditor Props (v2.6)

```typescript
interface EmailTemplateEditorProps {
  template: EmailTemplate | null;        // í¸ì§‘ ëŒ€ìƒ (null = ìƒˆ í…œí”Œë¦¿)
  onChange: (field: 'name' | 'subjectTemplate' | 'bodyTemplate', value: string) => void;
  variableList: Array<{ label: string; value: string }>;  // ë³€ìˆ˜ ì‚½ì… ë“œë¡­ë‹¤ìš´ ëª©ë¡
}
```

### EmailTemplateEditModal Props (v2.4)

```typescript
interface EmailTemplateEditModalProps {
  isOpen: boolean;
  onClose: () => void;
  projectId: string;                    // v2.4: í”„ë¡œì íŠ¸ ì»¨í…ìŠ¤íŠ¸
  template: EmailTemplate | null;       // null = ìƒˆ í…œí”Œë¦¿ ìƒì„± ëª¨ë“œ
  calculationResult: CalculationResult | null; // ë¯¸ë¦¬ë³´ê¸°ìš© (ì—†ìœ¼ë©´ ë¯¸ë¦¬ë³´ê¸° ë¹„í™œì„±í™”)
  onSave: (template: EmailTemplate) => void;   // v2.8: ì €ì¥ ì™„ë£Œ í›„ í˜¸ì¶œë˜ëŠ” ì½œë°± (ë®¤í…Œì´ì…˜ì€ ëª¨ë‹¬ ë‚´ë¶€ì—ì„œ useCreateEmailTemplate/useUpdateEmailTemplateë¡œ ì²˜ë¦¬)
}
```

### emailTemplates API í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜ (v2.4)

```typescript
// src/lib/api/emailTemplates.ts
// âš ï¸ Supabase Row(snake_case) â†’ í”„ë¡ íŠ¸ì—”ë“œ(camelCase) ë³€í™˜ì€
//    ê¸°ì¡´ í”„ë¡œì íŠ¸ íŒ¨í„´(src/lib/api/*.ts)ê³¼ ë™ì¼í•˜ê²Œ ì ìš©.
//    ì˜ˆ: project_id â†’ projectId, subject_template â†’ subjectTemplate

/**
 * í”„ë¡œì íŠ¸ë³„ í…œí”Œë¦¿ ëª©ë¡ ì¡°íšŒ
 * v2.7: ì •ë ¬ ìˆœì„œ â€” is_built_in DESC (built-in ë¨¼ì €), created_at DESC (ìµœì‹  ë¨¼ì €)
 *       ë™ì¼ is_built_in + ë™ì¼ created_atì¸ ê²½ìš°: name ASC (v2.8: 3ì°¨ ì •ë ¬ ê¸°ì¤€ ì¶”ê°€)
 *       Supabase query: .order('is_built_in', { ascending: false }).order('created_at', { ascending: false }).order('name', { ascending: true })
 */
async function fetchEmailTemplates(projectId: string): Promise<EmailTemplate[]>;

/** í…œí”Œë¦¿ ë‹¨ê±´ ì¡°íšŒ */
async function fetchEmailTemplate(templateId: string): Promise<EmailTemplate>;

/** í…œí”Œë¦¿ ìƒì„± (í”„ë¡œì íŠ¸ ê·€ì†) */
async function createEmailTemplate(
  projectId: string,
  data: { name: string; subjectTemplate: string; bodyTemplate: string }
): Promise<EmailTemplate>;

/** í…œí”Œë¦¿ ìˆ˜ì • */
async function updateEmailTemplate(
  templateId: string,
  data: { name?: string; subjectTemplate?: string; bodyTemplate?: string }
): Promise<EmailTemplate>;

/** í…œí”Œë¦¿ ì‚­ì œ (ì‚¬ìš©ì ì •ì˜ë§Œ ê°€ëŠ¥) */
async function deleteEmailTemplate(templateId: string): Promise<void>;
```

### useEmailTemplates React Query í›… (v2.4)

```typescript
// src/hooks/useEmailTemplates.ts

/** í”„ë¡œì íŠ¸ë³„ í…œí”Œë¦¿ ëª©ë¡ */
function useEmailTemplates(projectId: string | undefined) {
  return useQuery({
    queryKey: ['emailTemplates', projectId],
    queryFn: () => fetchEmailTemplates(projectId!),
    enabled: !!projectId,
  });
}

/** í…œí”Œë¦¿ ìƒì„± ë®¤í…Œì´ì…˜ */
function useCreateEmailTemplate() {
  return useMutation({
    mutationFn: ({ projectId, data }: {
      projectId: string;
      data: { name: string; subjectTemplate: string; bodyTemplate: string };
    }) => createEmailTemplate(projectId, data),
    onSuccess: (_, { projectId }) => {
      queryClient.invalidateQueries({ queryKey: ['emailTemplates', projectId] });
    },
  });
}

/** í…œí”Œë¦¿ ìˆ˜ì • ë®¤í…Œì´ì…˜ (v2.6: êµ¬í˜„ ëª…ì‹œ) */
function useUpdateEmailTemplate() {
  return useMutation({
    mutationFn: ({ templateId, data, projectId }: {
      templateId: string;
      data: { name?: string; subjectTemplate?: string; bodyTemplate?: string };
      projectId: string;  // invalidationìš©
    }) => updateEmailTemplate(templateId, data),
    onSuccess: (_, { projectId }) => {
      queryClient.invalidateQueries({ queryKey: ['emailTemplates', projectId] });
    },
  });
}

/** í…œí”Œë¦¿ ì‚­ì œ ë®¤í…Œì´ì…˜ (v2.5: projectId ì „ë‹¬ í•„ìˆ˜ â€” invalidationì— í•„ìš”) */
function useDeleteEmailTemplate() {
  return useMutation({
    mutationFn: ({ templateId }: { templateId: string; projectId: string }) =>
      deleteEmailTemplate(templateId),  // projectIdëŠ” onSuccessì—ì„œ invalidationìš©ìœ¼ë¡œë§Œ ì‚¬ìš©
    onSuccess: (_, { projectId }) => {
      queryClient.invalidateQueries({ queryKey: ['emailTemplates', projectId] });
    },
  });
}
```

### Modal ì»´í¬ë„ŒíŠ¸ maxWidth í™•ì¥ (v2.7)

> **ê²°ì • (v2.7)**: ê¸°ì¡´ ê³µí†µ Modal ì»´í¬ë„ŒíŠ¸ì— `maxWidth` propì„ ì¶”ê°€í•˜ì—¬ ëª¨ë‹¬ë³„ ë„ˆë¹„ ì œì–´.
> ìƒˆ ì»´í¬ë„ŒíŠ¸ë¥¼ ë§Œë“¤ì§€ ì•Šê³  ê¸°ì¡´ Modalì„ í™•ì¥í•©ë‹ˆë‹¤.

```typescript
// src/components/Modal.tsx (ê¸°ì¡´ ì»´í¬ë„ŒíŠ¸ í™•ì¥)
// âš ï¸ v2.8: ê¸°ì¡´ Modalì˜ ëª¨ë“  propsë¥¼ ë³´ì¡´í•˜ë©°, maxWidthë§Œ ì¶”ê°€.
//    ì•„ë˜ëŠ” í™•ì¥ í›„ ì „ì²´ ì¸í„°í˜ì´ìŠ¤ (ê¸°ì¡´ props + ì‹ ê·œ props).
//    êµ¬í˜„ ì‹œ ê¸°ì¡´ Modal.tsxì˜ ì‹¤ì œ propsë¥¼ ê¸°ì¤€ìœ¼ë¡œ í™•ì¥í•  ê²ƒ.
interface ModalProps {
  isOpen: boolean;
  onClose: () => void;
  title?: string;
  footer?: React.ReactNode;    // ê¸°ì¡´ Modalì— ì¡´ì¬í•˜ëŠ” ê²½ìš° ë³´ì¡´
  maxWidth?: string;            // v2.7: ëª¨ë‹¬ë³„ ìµœëŒ€ ë„ˆë¹„ (ê¸°ë³¸ê°’: '600px')
  children: React.ReactNode;
}

// ì‚¬ìš© ì˜ˆ:
// <Modal maxWidth="800px">   â†’ EmailGeneratorModal
// <Modal maxWidth="1100px">  â†’ EmailTemplateEditModal
```

### EmailGeneratorModal Props (v2.3)

```typescript
interface EmailGeneratorModalProps {
  isOpen: boolean;
  onClose: () => void;
  projectId: string;
  project: Project;              // v2.8: generateEmail depsì— project í•„ìš” (disclaimer, showIosReviewDate ë“±)
  updateDate: Date;
  /** í˜„ì¬ í”„ë¡œì íŠ¸ì˜ ê³„ì‚° ê²°ê³¼. nullì´ë©´ ë¯¸ë¦¬ë³´ê¸° ë¹„í™œì„±í™”. */
  calculationResult: CalculationResult | null;
}
```

### EmailGeneratorModal ë‚´ë¶€ ìƒíƒœ (v2.7)

> **ê²°ì • (v2.7)**: ì´ë©”ì¼ ìƒì„± ê²°ê³¼ì™€ ìƒì„± ì¤‘ ìƒíƒœë¥¼ ëª¨ë‹¬ ë‚´ë¶€ì—ì„œ ê´€ë¦¬.

```typescript
// EmailGeneratorModal ë‚´ë¶€ ìƒíƒœ
const [selectedTableType, setSelectedTableType] = useState<'table1' | 'table2' | 'table3'>('table2');
const [selectedTemplateId, setSelectedTemplateId] = useState<string | null>(null);
const [showHtmlSource, setShowHtmlSource] = useState(false);
const [emailResult, setEmailResult] = useState<EmailGenerationResult | null>(null);  // v2.7

// v2.8: generateEmailì´ ë™ê¸° í•¨ìˆ˜ì´ë¯€ë¡œ, useMemoë¡œ ë³€í™˜ ê°€ëŠ¥.
//       ë‹¨, ì—ëŸ¬ ì²˜ë¦¬ì™€ ìƒíƒœ ì—…ë°ì´íŠ¸ê°€ í•„ìš”í•˜ë¯€ë¡œ useEffect íŒ¨í„´ì„ ìœ ì§€.
//       isGeneratingì€ ë™ê¸° í•¨ìˆ˜ì—ì„œëŠ” í•­ìƒ falseì´ì§€ë§Œ,
//       í–¥í›„ ë¹„ë™ê¸° ì „í™˜ ê°€ëŠ¥ì„±ê³¼ UI ì¼ê´€ì„±ì„ ìœ„í•´ ìƒíƒœë¡œ ìœ ì§€.
const [isGenerating, setIsGenerating] = useState(false);  // v2.7: ìƒì„± ì¤‘ ë¡œë”© ìƒíƒœ

// ì´ë©”ì¼ ìƒì„± (í…Œì´ë¸”/í…œí”Œë¦¿ ë³€ê²½ ì‹œ ìë™ ì‹¤í–‰ â€” v2.7: ë™ê¸° í•¨ìˆ˜)
useEffect(() => {
  if (!selectedTemplateId || !calculationResult) {
    setEmailResult(null);
    return;
  }
  setIsGenerating(true);
  try {
    const result = generateEmail(request, deps);  // v2.7: ë™ê¸° í˜¸ì¶œ
    setEmailResult(result);
  } catch {
    setEmailResult(null);
    // ì—ëŸ¬ í† ìŠ¤íŠ¸ëŠ” ì—ëŸ¬ ì²˜ë¦¬ í…Œì´ë¸”(Â§4.3) ì°¸ì¡°
  } finally {
    setIsGenerating(false);
  }
}, [selectedTableType, selectedTemplateId, calculationResult]);
```

### ì„¤ì • íƒ­ ì¶”ê°€

> **ê²°ì • (M1, m4, v2.4)**: SettingsScreenì— "ì´ë©”ì¼ í…œí”Œë¦¿" íƒ­ ì¶”ê°€. í”„ë¡œì íŠ¸ë³„ ê´€ë¦¬ì´ë¯€ë¡œ **í˜„ì¬ ì„ íƒëœ í”„ë¡œì íŠ¸**ì˜ í…œí”Œë¦¿ë§Œ í‘œì‹œ.

```typescript
// src/components/SettingsScreen.tsx
type SettingsTab = 'projects' | 'stages' | 'holidays' | 'jira' | 'emailTemplates';
```

> **ì ‘ê·¼ ì œì–´ (v2.2)**: ì„¤ì • í˜ì´ì§€ ìì²´ê°€ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ì‚¬ìš©ìë§Œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë¯€ë¡œ, ì´ë©”ì¼ í…œí”Œë¦¿ íƒ­ì— ë³„ë„ ì ‘ê·¼ ì œì–´ëŠ” ë¶ˆí•„ìš”.

**íƒ­ ë ˆì´ì•„ì›ƒ** (v2.4, v2.7 ë³´ê°•):
- **ìƒë‹¨**: í˜„ì¬ ì„ íƒëœ í”„ë¡œì íŠ¸ í‘œì‹œ (ë©”ì¸ í™”ë©´ì˜ í”„ë¡œì íŠ¸ ì„ íƒê³¼ ë™ê¸°í™”)
  - âš ï¸ **í”„ë¡œì íŠ¸ ë³€ê²½ ì‹œ** ì„¤ì • íƒ­ì´ ì—´ë ¤ìˆëŠ” ìƒíƒœì—ì„œ í”„ë¡œì íŠ¸ë¥¼ ë³€ê²½í•˜ë©´, ì´ë©”ì¼ í…œí”Œë¦¿ ëª©ë¡ì´ ìƒˆ í”„ë¡œì íŠ¸ì˜ í…œí”Œë¦¿ìœ¼ë¡œ ìë™ ê°±ì‹ ë¨ (React Query `queryKey: ['emailTemplates', projectId]`ì— ì˜í•œ ìë™ refetch)
- í…œí”Œë¦¿ ëª©ë¡ í…Œì´ë¸” (ì´ë¦„, ìœ í˜•, ìƒì„±ì¼, ìƒì„±ì, ì•¡ì…˜)
  - **ì •ë ¬ ìˆœì„œ (v2.7)**: built-in í…œí”Œë¦¿ ë¨¼ì € (ê¸°ë³¸, ìƒì„¸) â†’ ì‚¬ìš©ì ì •ì˜ í…œí”Œë¦¿ (`created_at` DESC)
- [+ ìƒˆ í…œí”Œë¦¿] ë²„íŠ¼ â†’ ì•„ë˜ ì‹ ê·œ ìƒì„± íë¦„ ì°¸ì¡°
- í–‰ë³„ ì•¡ì…˜ (v2.2):
  - ê¸°ë³¸ ì œê³µ í…œí”Œë¦¿: [í¸ì§‘] ë²„íŠ¼ë§Œ (ì‚­ì œ ë¶ˆê°€)
  - ì‚¬ìš©ì ì •ì˜ í…œí”Œë¦¿: [í¸ì§‘] [ì‚­ì œ] ë²„íŠ¼
- **í”„ë¡œì íŠ¸ ë¯¸ì„ íƒ ì‹œ**: "í”„ë¡œì íŠ¸ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”" ë©”ì‹œì§€ í‘œì‹œ

### ìƒˆ í…œí”Œë¦¿ ìƒì„± íë¦„ (v2.3)

> **ê²°ì • (v2.3)**: `[+ ìƒˆ í…œí”Œë¦¿]` â†’ ë¹ˆ í¸ì§‘ ëª¨ë‹¬ ì—´ë¦¼

```
[+ ìƒˆ í…œí”Œë¦¿] ë²„íŠ¼ í´ë¦­
  â†“
[ë¹ˆ í¸ì§‘ ëª¨ë‹¬ ì—´ë¦¼]
  â”œâ”€ ì´ë¦„: "" (ë¹ˆ ì…ë ¥ í•„ë“œ, í¬ì»¤ìŠ¤)
  â”œâ”€ ì œëª© í…œí”Œë¦¿: "" (ë¹ˆ ì…ë ¥ í•„ë“œ)
  â”œâ”€ ë³¸ë¬¸ í¸ì§‘: ë¹ˆ TipTap ì—ë””í„°
  â””â”€ ë¯¸ë¦¬ë³´ê¸°: ë¹ˆ ìƒíƒœ ("ë³¸ë¬¸ì„ ì…ë ¥í•˜ë©´ ë¯¸ë¦¬ë³´ê¸°ê°€ í‘œì‹œë©ë‹ˆë‹¤")
  â†“
[ì €ì¥] í´ë¦­
  â”œâ”€ ì´ë¦„ ë¹„ì–´ìˆìŒ â†’ ì¸ë¼ì¸ ê²½ê³  "ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"
  â”œâ”€ ì´ë¦„ ì¤‘ë³µ â†’ ì—ëŸ¬ í† ìŠ¤íŠ¸ "ì´ë¯¸ ì¡´ì¬í•˜ëŠ” í…œí”Œë¦¿ ì´ë¦„ì…ë‹ˆë‹¤"
  â””â”€ ì„±ê³µ â†’ ëª©ë¡ì— ì¶”ê°€, ëª¨ë‹¬ ë‹«ê¸°, ì„±ê³µ í† ìŠ¤íŠ¸ "í…œí”Œë¦¿ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤"
```

## 4.4 ì´ë©”ì¼ ìƒì„± íŒŒì´í”„ë¼ì¸ (v2.2)

> EmailGenerationRequest í•˜ë‚˜ë¡œ ëª¨ë“  í…œí”Œë¦¿ ë³€ìˆ˜ë¥¼ ì±„ìš¸ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ, ìƒì„± íŒŒì´í”„ë¼ì¸ì„ ëª…ì„¸í•©ë‹ˆë‹¤.

```typescript
// src/lib/email/generator.ts

/**
 * ì´ë©”ì¼ ìƒì„± íŒŒì´í”„ë¼ì¸
 * v2.7: ë™ê¸° í•¨ìˆ˜ â€” ëª¨ë“  ì˜ì¡´ ë°ì´í„°ê°€ ì´ë¯¸ ë¡œë“œë˜ì–´ ì „ë‹¬ë˜ë¯€ë¡œ ë¹„ë™ê¸° ì‘ì—… ì—†ìŒ.
 *       async/awaitê°€ í•„ìš” ì—†ìœ¼ë©°, í˜¸ì¶œë¶€ì—ì„œ ë™ê¸°ì ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥.
 * @param request - ìƒì„± ìš”ì²­ (í”„ë¡œì íŠ¸ID, í…Œì´ë¸” íƒ€ì…, í…œí”Œë¦¿ID ë“±)
 * @param deps - ì´ë¯¸ ë¡œë“œëœ ì˜ì¡´ ë°ì´í„° (ëª¨ë‹¬ì—ì„œ ì „ë‹¬, DB ì¬ì¡°íšŒ ë°©ì§€)
 */
function generateEmail(
  request: EmailGenerationRequest,
  deps: {
    template: EmailTemplate;
    project: Project;
    calcResult: CalculationResult;
  }
): EmailGenerationResult {
  const { template, project, calcResult } = deps;

  // 1. ìƒë‹¨ ë‚ ì§œ í¬ë§·íŒ… (ì´ë©”ì¼ìš©: ì‹œê°„ ì œì™¸)
  const updateDate = formatEmailDate(request.updateDate);         // MM/DD(ìš”ì¼) â€” ì‹œê°„ ì—†ìŒ
  const updateDateShort = formatUpdateDateShort(request.updateDate); // MM-DD
  const headsUp = formatEmailDate(calcResult.headsUpDate);         // MM/DD(ìš”ì¼) â€” ì‹œê°„ ì—†ìŒ
  const iosReviewDate = calcResult.iosReviewDate
    ? formatEmailDate(calcResult.iosReviewDate)                    // MM/DD(ìš”ì¼) â€” ì‹œê°„ ì—†ìŒ
    : null;

  // 2. í…Œì´ë¸” HTML ìƒì„±
  const entries = getEntriesByTableType(calcResult, request.tableType);
  const tableHtml = formatTableHtml(entries, request.tableType);

  // 3. Disclaimer ì²˜ë¦¬
  const disclaimerHtml = renderDisclaimerHtml(project.disclaimer);

  // 4. í…œí”Œë¦¿ ë³€ìˆ˜ ì»¨í…ìŠ¤íŠ¸ êµ¬ì„±
  const context: TemplateContext = {
    updateDate,
    updateDateShort,
    headsUp,
    iosReviewDate,
    paidProductDate,                          // v3.0: ìœ ë£Œí™” ìƒí’ˆ í˜‘ì˜ ì¼ì • ë³€ìˆ˜ ì¶”ê°€
    table: tableHtml,
    disclaimer: disclaimerHtml || null,       // v2.5: ë¹ˆ ë¬¸ìì—´ â†’ null ({{#if disclaimer}} ì¡°ê±´ë¶€ ë¸”ë¡ í‰ê°€ìš©)
    projectName: project.name,
    showIosReviewDate: project.showIosReviewDate && iosReviewDate != null,
    showPaidProductDate: project.showPaidProductDate && paidProductDate != null, // v3.0
  };

  // 5. í…œí”Œë¦¿ ë Œë”ë§ (entity ë””ì½”ë”© â†’ ì¡°ê±´ë¶€ â†’ ë³€ìˆ˜ ìˆœì„œ â€” Â§2.5 renderTemplate ì°¸ì¡°)
  const subject = stripHtmlTags(renderTemplate(template.subjectTemplate, context)); // v2.5: subjectëŠ” plain textì´ë¯€ë¡œ HTML íƒœê·¸ strip
  const renderedBody = renderTemplate(template.bodyTemplate, context);

  // 6. inline ìŠ¤íƒ€ì¼ ë³€í™˜ (v2.5: juice ì ìš© ì‹œì  ëª…í™•í™”)
  const bodyHtml = convertToInlineStyles(renderedBody);  // juice ë³€í™˜
  const bodyText = htmlToPlainText(bodyHtml);

  return { subject, bodyHtml, bodyText };
}

/**
 * HTML íƒœê·¸ ì œê±° (ì œëª©ìš© â€” v2.5)
 * subject í…œí”Œë¦¿ì— ì‹¤ìˆ˜ë¡œ HTML íƒœê·¸ê°€ í¬í•¨ë  ê²½ìš° strip ì²˜ë¦¬
 */
function stripHtmlTags(text: string): string {
  return text.replace(/<[^>]*>/g, '').trim();
}
```

### íŒŒì´í”„ë¼ì¸ ìœ í‹¸ í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜ (v2.5)

```typescript
// src/lib/email/tableFormatter.ts

/**
 * ê³„ì‚° ê²°ê³¼ì—ì„œ í…Œì´ë¸” íƒ€ì…ë³„ ì—”íŠ¸ë¦¬ ì¶”ì¶œ
 * v2.7: children í¬í•¨ í‰íƒ„í™” â€” CalculationResultì˜ schedule_entriesëŠ”
 *       ê³„ì¸µ êµ¬ì¡°(parent + children)ì´ë¯€ë¡œ, ì´ë©”ì¼ í…Œì´ë¸” ë Œë”ë§ì„ ìœ„í•´
 *       parent â†’ children ìˆœì„œë¡œ flat arrayë¡œ ë³€í™˜.
 *       ì˜ˆ: [{ index: "1", children: [{ index: "1.1" }, { index: "1.2" }] }, { index: "2" }]
 *       â†’ [{ index: "1" }, { index: "1.1" }, { index: "1.2" }, { index: "2" }]
 *       v2.8: indexëŠ” dot-notation í˜•ì‹ (ì˜ˆ: "1", "1.1", "1.2", "2") â€” ì´ë©”ì¼ í…Œì´ë¸” # ì»¬ëŸ¼ì— ê·¸ëŒ€ë¡œ í‘œì‹œ
 */
function getEntriesByTableType(
  calcResult: CalculationResult,
  tableType: 'table1' | 'table2' | 'table3'
): ScheduleEntry[];

/** ì—”íŠ¸ë¦¬ ë°°ì—´ â†’ HTML <table> ë³€í™˜ (Â§2.2 ì»¬ëŸ¼ êµ¬ì„±ì— ë”°ë¼) */
function formatTableHtml(
  entries: ScheduleEntry[],
  tableType: 'table1' | 'table2' | 'table3'
): string;
```

```typescript
// src/lib/email/htmlToPlainText.ts

/**
 * HTML â†’ í”Œë ˆì¸í…ìŠ¤íŠ¸ ë³€í™˜ (Â§2.8 ê·œì¹™ ì ìš©)
 * - <p> â†’ text\n\n
 * - <br> â†’ \n
 * - <li> â†’ â€¢ item\n
 * - <strong>/<em>/<u> â†’ íƒœê·¸ë§Œ ì œê±°
 * - <a href="url">text</a> â†’ text (ë§í¬ í…ìŠ¤íŠ¸ë§Œ ë³´ì¡´, URL ì œê±° â€” v2.7)
 * - <table> â†’ í–‰ë³„ ì…€ ë‚´ìš©ì„ íƒ­(\t) êµ¬ë¶„, í–‰ ê°„ ì¤„ë°”ê¿ˆ(\n) (v2.5)
 * - HTML entities â†’ ì›ë³¸ ë¬¸ì (&amp; â†’ &)
 */
function htmlToPlainText(html: string): string;
```

```typescript
// src/lib/disclaimer/renderers/html.ts

/**
 * Disclaimer ì»¤ìŠ¤í…€ íƒœê·¸ â†’ HTML ë³€í™˜ (Â§2.7 ê·œì¹™ ì ìš©)
 * - disclaimerê°€ nullì´ë©´ ë¹ˆ ë¬¸ìì—´ ë°˜í™˜
 * - disclaimerë¥¼ trim() í›„, ì»¤ìŠ¤í…€ íƒœê·¸ë¥¼ stripí•œ ê²°ê³¼ê°€ ë¹ˆ ë¬¸ìì—´ì´ë©´ ë¹ˆ ë¬¸ìì—´ ë°˜í™˜ (v2.6: ê³µë°± ì „ìš©ë„ ë¹ˆ ì·¨ê¸‰)
 * - ê·¸ ì™¸: sanitize â†’ parse â†’ HTML ë Œë”ë§
 *
 * ì²˜ë¦¬ ìˆœì„œ (v2.6):
 *   1. null ì²´í¬ â†’ ë¹ˆ ë°˜í™˜
 *   2. trim() + ì»¤ìŠ¤í…€ íƒœê·¸ strip â†’ ë¹ˆ ë¬¸ìì—´ì´ë©´ ë¹ˆ ë°˜í™˜
 *   3. sanitize(input) â€” XSS ë°©ì§€ (Â§2.7)
 *   4. parse(sanitized) â€” AST ìƒì„±
 *   5. renderHtml(ast) â€” HTML ë³€í™˜
 *
 * v2.8: ë‚´ë¶€ try/catch â€” íŒŒì‹±/ë Œë”ë§ ì‹¤íŒ¨ ì‹œ ë¹ˆ ë¬¸ìì—´ ë°˜í™˜ + console.warn ë¡œê¹….
 *       í˜¸ì¶œë¶€(generateEmail)ì—ì„œ Disclaimer ì—ëŸ¬ë¡œ ì „ì²´ ìƒì„±ì´ ì‹¤íŒ¨í•˜ì§€ ì•Šë„ë¡ ë°©ì–´.
 *       ì—ëŸ¬ ì²˜ë¦¬ í…Œì´ë¸”(Â§4.3)ì˜ "Disclaimer ë Œë”ë§ ì‹¤íŒ¨" í•­ëª©ê³¼ ì¼ì¹˜.
 */
function renderDisclaimerHtml(disclaimer: string | null): string;
```

### ì´ë©”ì¼ ì „ìš© ë‚ ì§œ í˜•ì‹ í•¨ìˆ˜ (v2.3)

> **ê²°ì • (v2.3)**: ì´ë©”ì¼ ë³€ìˆ˜ì˜ ë‚ ì§œëŠ” **ì‹œê°„ ì—†ì´ ë‚ ì§œë§Œ** í‘œì‹œ (`M/D` í˜•ì‹). í…Œì´ë¸” ì…€ ë‚´ ë‚ ì§œ(`formatTableDate`)ëŠ” ê¸°ì¡´ `MM/DD(ìš”ì¼) HH:MM` ìœ ì§€.

```typescript
/**
 * Date â†’ ì´ë©”ì¼ ë³¸ë¬¸ìš© ë‚ ì§œ í˜•ì‹ (ì‹œê°„ ì œì™¸)
 * @returns "MM/DD(ìš”ì¼)" í˜•ì‹
 * @example "02/10(ì›”)"
 *
 * âš ï¸ formatTableDate()ì™€ ë‹¤ë¥´ê²Œ ì‹œê°„(HH:MM)ì„ í¬í•¨í•˜ì§€ ì•ŠìŒ.
 *    ì´ë©”ì¼ ë³€ìˆ˜({updateDate}, {headsUp}, {iosReviewDate})ì—ë§Œ ì‚¬ìš©.
 * v2.8: Invalid Date ì²˜ë¦¬ â€” isNaN(date.getTime()) ì‹œ '[ìœ íš¨í•˜ì§€ ì•Šì€ ë‚ ì§œ]' ë°˜í™˜
 */
function formatEmailDate(date: Date): string {
  if (isNaN(date.getTime())) return '[ìœ íš¨í•˜ì§€ ì•Šì€ ë‚ ì§œ]';
  const WEEKDAYS = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
  const mm = String(date.getMonth() + 1).padStart(2, '0');
  const dd = String(date.getDate()).padStart(2, '0');
  const day = WEEKDAYS[date.getDay()];
  return `${mm}/${dd}(${day})`;
}

/**
 * Date â†’ ì´ë©”ì¼ ì œëª©ìš© ì§§ì€ í˜•ì‹
 * ìœ„ì¹˜: src/lib/email/generator.ts (v2.5)
 * @returns "MM-DD" í˜•ì‹
 * @example "02-10"
 */
function formatUpdateDateShort(date: Date): string {
  const mm = String(date.getMonth() + 1).padStart(2, '0');
  const dd = String(date.getDate()).padStart(2, '0');
  return `${mm}-${dd}`;
}
```

> **ì°¸ê³ **: í…Œì´ë¸” ì…€ ë‚´ì˜ ë‚ ì§œ (ë§ˆê°, HO, HB ë“±)ëŠ” ê¸°ì¡´ `formatTableDate()` (`MM/DD(ìš”ì¼) HH:MM`)ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.

### ëª¨ë‹¬ ìƒíƒœ ì´ˆê¸°í™” (v2.6)

> **ê²°ì • (v2.6)**: ëª¨ë‹¬ì„ ì—´ ë•Œë§ˆë‹¤ ë‚´ë¶€ ìƒíƒœë¥¼ ì´ˆê¸°ê°’ìœ¼ë¡œ ë¦¬ì…‹í•˜ì—¬ ì´ì „ ì„¸ì…˜ì˜ ì”ì¡´ ìƒíƒœ ë°©ì§€.
> **êµ¬í˜„ íŒ¨í„´ (v2.8)**: `useEffect(() => { if (isOpen) { /* ëª¨ë“  ìƒíƒœ ì´ˆê¸°ê°’ìœ¼ë¡œ ë¦¬ì…‹ */ } }, [isOpen]);`

| ìƒíƒœ | ì´ˆê¸°ê°’ | ì„¤ëª… |
|------|--------|------|
| `selectedTableType` | `'table2'` | T2 (Ext. ì™¸ë¶€ìš©) ê¸°ë³¸ ì„ íƒ |
| `selectedTemplateId` | ê¸°ë³¸ í…œí”Œë¦¿ ID | ì²« ë²ˆì§¸ built-in í…œí”Œë¦¿ (v2.8: í…œí”Œë¦¿ ëª©ë¡ ë¡œë“œ ì™„ë£Œ í›„ useEffectë¡œ ì„¤ì • â€” `templates[0]?.id ?? null`) |
| `showHtmlSource` | `false` | ë Œë”ë§ ë¯¸ë¦¬ë³´ê¸° ëª¨ë“œ |
| `emailResult` | `null` | ìƒì„±ëœ ì´ë©”ì¼ ê²°ê³¼ (v2.7) |
| `isGenerating` | `false` | ì´ë©”ì¼ ìƒì„± ì¤‘ ë¡œë”© ìƒíƒœ (v2.7) |

### ì—ëŸ¬ ì²˜ë¦¬ (v2.2)

| ìƒí™© | ì²˜ë¦¬ |
|------|------|
| ê³„ì‚° ê²°ê³¼ ì—†ìŒ | ì—ëŸ¬ í† ìŠ¤íŠ¸ "ë¨¼ì € ê³„ì‚°ì„ ì‹¤í–‰í•´ì£¼ì„¸ìš”" |
| í…œí”Œë¦¿ ì¡°íšŒ ì‹¤íŒ¨ | ì—ëŸ¬ í† ìŠ¤íŠ¸ "í…œí”Œë¦¿ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤" + í…œí”Œë¦¿ ì„ íƒ ì˜ì—­ì— "ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”." ë©”ì‹œì§€ + [ë‹¤ì‹œ ì‹œë„] ë²„íŠ¼ (v2.6) |
| í”„ë¡œì íŠ¸ ì •ë³´ ì—†ìŒ | ì—ëŸ¬ í† ìŠ¤íŠ¸ "í”„ë¡œì íŠ¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤" |
| í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨ | ì—ëŸ¬ í† ìŠ¤íŠ¸ "í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”." |
| Disclaimer ë Œë”ë§ ì‹¤íŒ¨ | Disclaimer ì˜ì—­ ë¹ˆ ë¬¸ìì—´ ì¶œë ¥ + ì½˜ì†” ê²½ê³  (v2.4) |
| ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ (ê³µí†µ) | ì—ëŸ¬ í† ìŠ¤íŠ¸ "ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”." (v2.4) |

### í…œí”Œë¦¿ CRUD ì—ëŸ¬ ì²˜ë¦¬ (v2.2)

| ì‘ì—… | ì—ëŸ¬ ìƒí™© | ì²˜ë¦¬ |
|------|----------|------|
| **ìƒì„±** | ì´ë¦„ ì¤‘ë³µ | ì—ëŸ¬ í† ìŠ¤íŠ¸ "ì´ë¯¸ ì¡´ì¬í•˜ëŠ” í…œí”Œë¦¿ ì´ë¦„ì…ë‹ˆë‹¤" |
| **ìƒì„±** | ì´ë¦„ 50ì ì´ˆê³¼ | ì €ì¥ ë²„íŠ¼ ë¹„í™œì„±í™” + ì¸ë¼ì¸ ê²½ê³  "ì´ë¦„ì€ 50ì ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”" |
| **ìˆ˜ì •** | ë„¤íŠ¸ì›Œí¬ ì‹¤íŒ¨ | ì—ëŸ¬ í† ìŠ¤íŠ¸ "ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”." |
| **ì‚­ì œ** | ê¸°ë³¸ ì œê³µ í…œí”Œë¦¿ ì‚­ì œ ì‹œë„ | RLSì—ì„œ ì°¨ë‹¨ (UIì—ì„œë„ ì‚­ì œ ë²„íŠ¼ ìˆ¨ê¹€) |
| **ì‚­ì œ** | í™•ì¸ | ì‚­ì œ ì „ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ "'{name}' í…œí”Œë¦¿ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?" |

## 4.5 í´ë¦½ë³´ë“œ ë³µì‚¬ (Safari í˜¸í™˜)

> **ê²°ì • (M8)**: Safari Promise íŒ¨í„´ ì ìš©

```typescript
// src/lib/email/clipboard.ts

async function copyEmailToClipboard(
  html: string,
  text: string
): Promise<void> {
  // Safari í˜¸í™˜: ClipboardItemì— Promise ì „ë‹¬
  const htmlBlob = new Blob([html], { type: 'text/html' });
  const textBlob = new Blob([text], { type: 'text/plain' });

  try {
    await navigator.clipboard.write([
      new ClipboardItem({
        'text/html': Promise.resolve(htmlBlob),
        'text/plain': Promise.resolve(textBlob),
      }),
    ]);
  } catch (err) {
    // Safari user activation ë§Œë£Œ ì‹œ
    if (err instanceof Error && err.name === 'NotAllowedError') {
      throw new Error('í´ë¦½ë³´ë“œ ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ë²„íŠ¼ì„ ë‹¤ì‹œ í´ë¦­í•´ì£¼ì„¸ìš”.');
    }
    throw err;
  }
}
```

> **[í´ë¦½ë³´ë“œ ë³µì‚¬] ë²„íŠ¼ ë¡œë”© ìƒíƒœ (v2.7)**: ë³µì‚¬ ì§„í–‰ ì¤‘ ë²„íŠ¼ì— ìŠ¤í”¼ë„ˆ í‘œì‹œ + ë¹„í™œì„±í™”í•˜ì—¬ ì¤‘ë³µ í´ë¦­ ë°©ì§€.
> ```typescript
> const [isCopying, setIsCopying] = useState(false);
> // í´ë¦­ í•¸ë“¤ëŸ¬: setIsCopying(true) â†’ copyEmailToClipboard() â†’ setIsCopying(false)
> ```

---

# 5. ê¸°ìˆ  ìŠ¤íƒ (Phase 2)

| ê¸°ìˆ  | ìš©ë„ | ë¹„ê³  |
|------|------|------|
| Clipboard API | ì´ë©”ì¼ HTML ë³µì‚¬ | `navigator.clipboard.write()` |
| **TipTap** | ì´ë©”ì¼ í…œí”Œë¦¿ WYSIWYG ì—ë””í„° | `@tiptap/react` ^2.4.0 |
| **juice** | TipTap HTML â†’ inline ìŠ¤íƒ€ì¼ ë³€í™˜ | Gmail/Outlook í˜¸í™˜ (m5) |

### TipTap ì—ë””í„° ê¸°ëŠ¥ ëª…ì„¸

| ê¸°ëŠ¥ | í¬í•¨ ì—¬ë¶€ | ì„¤ëª… |
|------|-----------|------|
| **ê¸°ë³¸ ì„œì‹** | âœ… | Bold, Italic, Underline |
| **ì œëª©** | âŒ | H1, H2, H3 - ì´ë©”ì¼ì— ë¶ˆí•„ìš” |
| **ëª©ë¡** | âœ… | ìˆœì„œ ìˆëŠ”/ì—†ëŠ” ëª©ë¡ |
| **ë§í¬** | âœ… | URL ì‚½ì… |
| **í…Œì´ë¸”** | âœ… | í‘œ ì‚½ì…/í¸ì§‘ |
| **ìƒ‰ìƒ** | âœ… | í…ìŠ¤íŠ¸/ë°°ê²½ ìƒ‰ìƒ |
| **ì •ë ¬** | âœ… | ì™¼ìª½/ê°€ìš´ë°/ì˜¤ë¥¸ìª½ |
| **ë³€ìˆ˜ ì‚½ì…** | âœ… | íˆ´ë°” ë“œë¡­ë‹¤ìš´ìœ¼ë¡œ ì»¤ì„œ ìœ„ì¹˜ì— ë³€ìˆ˜ ì‚½ì… (ì•„ë˜ ìƒì„¸) |

### TipTap ë³€ìˆ˜ ì…ë ¥ ë°©ì‹ (v2.2)

> **ê²°ì •**: ë³€ìˆ˜/ì¡°ê±´ë¶€ ë¸”ë¡ì€ ì¼ë°˜ í…ìŠ¤íŠ¸ë¡œ ì§ì ‘ íƒ€ì´í•‘. ì‚½ì… ë²„íŠ¼ì€ íˆ´ë°” ë“œë¡­ë‹¤ìš´.

| ë°©ì‹ | ì„¤ëª… |
|------|------|
| **ì§ì ‘ íƒ€ì´í•‘** | `{projectName}`, `{{#if showIosReviewDate}}...{{/if}}` ë“±ì„ í…ìŠ¤íŠ¸ë¡œ ì§ì ‘ ì…ë ¥ |
| **íˆ´ë°” ë“œë¡­ë‹¤ìš´** | ë³¸ë¬¸ TipTap ì—ë””í„° íˆ´ë°”ì— [ë³€ìˆ˜ ì‚½ì… â–¼] ë²„íŠ¼ â†’ ë“œë¡­ë‹¤ìš´ ëª©ë¡ì—ì„œ í´ë¦­ ì‹œ ì»¤ì„œ ìœ„ì¹˜ì— ì‚½ì… |
| **ì œëª© í•„ë“œ** | plain `<input type="text">`ì´ë¯€ë¡œ ë³€ìˆ˜ ì‚½ì… = **ì§ì ‘ íƒ€ì´í•‘ë§Œ** ê°€ëŠ¥ (ë“œë¡­ë‹¤ìš´ ì—†ìŒ) (v2.5) |

**ë“œë¡­ë‹¤ìš´ ëª©ë¡**:
- `{updateDate}` - ì—…ë°ì´íŠ¸ ë‚ ì§œ
- `{updateDateShort}` - ì—…ë°ì´íŠ¸ ë‚ ì§œ (ì§§ì€ í˜•ì‹)
- `{headsUp}` - í—¤ì¦ˆì—… ë‚ ì§œ
- `{iosReviewDate}` - iOS ì‹¬ì‚¬ ë‚ ì§œ
- `{table}` - ì¼ì • í…Œì´ë¸”
- `{disclaimer}` - Disclaimer
- `{projectName}` - í”„ë¡œì íŠ¸ ì´ë¦„
- `{{#if showIosReviewDate}}...{{/if}}` - iOS ì‹¬ì‚¬ì¼ ì¡°ê±´ë¶€ ë¸”ë¡
- `{{#if disclaimer}}...{{/if}}` - Disclaimer ì¡°ê±´ë¶€ ë¸”ë¡ (v2.5)

> **ì¡°ê±´ë¶€ ë¸”ë¡ ì‚½ì… ë™ì‘ (v2.7)**: íˆ´ë°” ë“œë¡­ë‹¤ìš´ì—ì„œ ì¡°ê±´ë¶€ ë¸”ë¡ í•­ëª© í´ë¦­ ì‹œ, **ê¸°ë³¸ ë‚´ìš©ì„ í¬í•¨í•œ ì™„ì „í•œ ë¸”ë¡**ì´ ì»¤ì„œ ìœ„ì¹˜ì— ì‚½ì…ë©ë‹ˆë‹¤.
> - `{{#if showIosReviewDate}}`: `{{#if showIosReviewDate}}<li>â–¡ iOS ì‹¬ì‚¬ì¼: {iosReviewDate}</li>{{/if}}` ì‚½ì…
> - `{{#if disclaimer}}`: `{{#if disclaimer}}<p style="color: #666666; font-size: 12px; margin-top: 16px;">â€» Disclaimer: {disclaimer}</p>{{/if}}` ì‚½ì…
> - ì‚½ì… í›„ ì»¤ì„œ ìœ„ì¹˜: ë¸”ë¡ ë(`{{/if}}` ë’¤)
> - ì‚¬ìš©ìëŠ” ì‚½ì…ëœ ê¸°ë³¸ ë‚´ìš©ì„ ììœ ë¡­ê²Œ í¸ì§‘ ê°€ëŠ¥

### í¸ì§‘ ëª¨ë‹¬ ë ˆì´ì•„ì›ƒ (v2.2)

> **ê²°ì •**: ì¢Œìš° ë¶„í•  ë ˆì´ì•„ì›ƒ (ì¢Œ: TipTap ì—ë””í„°, ìš°: ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸°)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ í…œí”Œë¦¿ í¸ì§‘: "ê¸°ë³¸"                                                        [âœ•]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì œëª© í…œí”Œë¦¿                                                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ [L10n] {updateDateShort} ì—…ë°ì´íŠ¸ ì¼ì • ì•ˆë‚´                                 â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ ë¯¸ë¦¬ë³´ê¸° í…Œì´ë¸”: [T1 â–¼] (v2.6: í¸ì§‘ ëª¨ë‹¬ì—ì„œë„ í…Œì´ë¸” íƒ€ì… ì„ íƒ ê°€ëŠ¥)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ë³¸ë¬¸ í¸ì§‘                        â”‚ ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸° (300ms ë””ë°”ìš´ìŠ¤ â€” v2.6)        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ [B][I][U] [ëª©ë¡] [ìƒ‰ìƒ]     â”‚ â”‚ â”‚                                          â”‚   â”‚
â”‚ â”‚ [ë§í¬] [í…Œì´ë¸”] [ë³€ìˆ˜ â–¼]    â”‚ â”‚ â”‚  ì•ˆë…•í•˜ì„¸ìš”,                              â”‚   â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚                                          â”‚   â”‚
â”‚ â”‚                             â”‚ â”‚ â”‚  ë‹¤ìŒê³¼ ê°™ì´ 02/10(ì›”) ì—…ë°ì´íŠ¸           â”‚   â”‚
â”‚ â”‚ ì•ˆë…•í•˜ì„¸ìš”,                 â”‚ â”‚ â”‚  í˜„ì§€í™” ì¼ì •ì„ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.              â”‚   â”‚
â”‚ â”‚                             â”‚ â”‚ â”‚                                          â”‚   â”‚
â”‚ â”‚ ë‹¤ìŒê³¼ ê°™ì´ {updateDate}    â”‚ â”‚ â”‚  â–¡ í—¤ì¦ˆì—…: 01/28(í™”)                     â”‚   â”‚
â”‚ â”‚ ì—…ë°ì´íŠ¸ í˜„ì§€í™” ì¼ì •ì„...   â”‚ â”‚ â”‚  â–¡ iOS ì‹¬ì‚¬ì¼: 02/03(ì›”)                 â”‚   â”‚
â”‚ â”‚                             â”‚ â”‚ â”‚                                          â”‚   â”‚
â”‚ â”‚ {table}                     â”‚ â”‚ â”‚  [ì¼ì •í‘œ]                                â”‚   â”‚
â”‚ â”‚                             â”‚ â”‚ â”‚  â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚   â”‚
â”‚ â”‚ {disclaimer}                â”‚ â”‚ â”‚  â”‚ #  â”‚ ë°°ì¹˜ â”‚  HO    â”‚  HB    â”‚         â”‚   â”‚
â”‚ â”‚                             â”‚ â”‚ â”‚  â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                        [ì·¨ì†Œ]  [ì €ì¥]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| í•­ëª© | ê°’ |
|------|------|
| **í¸ì§‘ ëª¨ë‹¬ í­** | ~1100px (`<Modal maxWidth="1100px">` â€” v2.7) |
| **ì¢Œì¸¡ (ì—ë””í„°)** | 50% ë„ˆë¹„, TipTap WYSIWYG |
| **ìš°ì¸¡ (ë¯¸ë¦¬ë³´ê¸°)** | 50% ë„ˆë¹„, ì‹¤ì‹œê°„ ë Œë”ë§ |
| **ë¯¸ë¦¬ë³´ê¸° ë°ì´í„°** | í˜„ì¬ í”„ë¡œì íŠ¸ì˜ ì‹¤ì œ ê³„ì‚° ê²°ê³¼ ì‚¬ìš© (ì—†ìœ¼ë©´ ë¯¸ë¦¬ë³´ê¸° ì˜ì—­ì— "ë¨¼ì € ê³„ì‚°ì„ ì‹¤í–‰í•´ì£¼ì„¸ìš”" ë©”ì‹œì§€ í‘œì‹œ, ë³µì‚¬ ë²„íŠ¼ ë¹„í™œì„±í™”) |
| **ë¯¸ë¦¬ë³´ê¸° ê°±ì‹ ** | ë³¸ë¬¸/ë³€ìˆ˜ ë³€ê²½ í›„ **300ms ë””ë°”ìš´ìŠ¤** ì ìš© (v2.6: ì…ë ¥ ì¤‘ ë¶ˆí•„ìš”í•œ ì¬ë Œë”ë§ ë°©ì§€). v2.8: `useDebouncedValue(bodyTemplate, 300)` ì»¤ìŠ¤í…€ í›… ì‚¬ìš© ë˜ëŠ” `useEffect` + `setTimeout`/`clearTimeout` íŒ¨í„´ |
| **TipTap ì—ë””í„° key** | ë‹¤ë¥¸ í…œí”Œë¦¿ í¸ì§‘ ì‹œ ì—ë””í„° ì¸ìŠ¤í„´ìŠ¤ ì¬ìƒì„± í•„ìš”: `<TipTapEditor key={template?.id ?? 'new'} />` (v2.7, v2.8: null í…œí”Œë¦¿(ì‹ ê·œ ìƒì„± ëª¨ë“œ) ëŒ€ì‘) |
| **ë¯¸ë¦¬ë³´ê¸° í…Œì´ë¸” ì„ íƒ** | í¸ì§‘ ëª¨ë‹¬ ìƒë‹¨ì— í…Œì´ë¸” íƒ€ì… ë“œë¡­ë‹¤ìš´ (T1/T2/T3) â€” ë¯¸ë¦¬ë³´ê¸°ìš© í…Œì´ë¸” ë³€ê²½ ê°€ëŠ¥ (v2.6) |
| **EmailGeneratorModal í­** | ~800px (`<Modal maxWidth="800px">` â€” v2.7) |
| **[í´ë¦½ë³´ë“œ ë³µì‚¬] í™œì„±í™” ì¡°ê±´** | ëª¨ë‹¬ì´ ì—´ë ¤ìˆê³  `emailResult !== null`ì´ê³  `checkClipboardSupport().supported === true`ì¸ ê²½ìš° í™œì„±í™” (v2.7) |

### ë¹„ì €ì¥ ë³€ê²½ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ (v2.4)

> **ê²°ì • (v2.4)**: í¸ì§‘ ëª¨ë‹¬ì—ì„œ ë³€ê²½ ì‚¬í•­ì´ ìˆì„ ë•Œ ë‹«ê¸°/ì·¨ì†Œ ì‹œ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ

| ìƒí™© | ë™ì‘ |
|------|------|
| ë³€ê²½ ì‚¬í•­ ì—†ì´ ë‹«ê¸° | ì¦‰ì‹œ ë‹«ê¸° |
| ë³€ê²½ ì‚¬í•­ ìˆì„ ë•Œ [âœ•] ë˜ëŠ” [ì·¨ì†Œ] | í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸: "ì €ì¥í•˜ì§€ ì•Šì€ ë³€ê²½ì‚¬í•­ì´ ìˆìŠµë‹ˆë‹¤. ë‹«ìœ¼ì‹œê² ìŠµë‹ˆê¹Œ?" |
| ë‹¤ì´ì–¼ë¡œê·¸ [ë‹«ê¸°] | ë³€ê²½ ì‚¬í•­ ë²„ë¦¬ê³  ëª¨ë‹¬ ë‹«ê¸° |
| ë‹¤ì´ì–¼ë¡œê·¸ [ì·¨ì†Œ] | ëª¨ë‹¬ë¡œ ë³µê·€ (ê³„ì† í¸ì§‘) |

```typescript
// v2.8: EditModal draft ìƒíƒœ (í¸ì§‘ ì¤‘ ì„ì‹œ ê°’)
const [name, setName] = useState(template?.name ?? '');
const [subjectTemplate, setSubjectTemplate] = useState(template?.subjectTemplate ?? '');
const [bodyTemplate, setBodyTemplate] = useState(template?.bodyTemplate ?? '');
const initialTemplate = useRef(template);  // ì´ˆê¸°ê°’ ìŠ¤ëƒ…ìƒ· (ë³€ê²½ ê°ì§€ìš©)

// ë³€ê²½ ê°ì§€: ì´ˆê¸°ê°’ê³¼ í˜„ì¬ê°’ ë¹„êµ (v2.5: TipTap HTML ì •ê·œí™”)
// âš ï¸ TipTapì€ HTML ì¶œë ¥ì— whitespace ì°¨ì´ê°€ ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ,
//    bodyTemplate ë¹„êµ ì‹œ editor.getHTML()ì˜ ê²°ê³¼ë¥¼ ì •ê·œí™”í•˜ì—¬ ë¹„êµ.
//    ì •ê·œí™”: ì—°ì† ê³µë°± ì¶•ì†Œ, ì•ë’¤ ê³µë°± ì œê±°
// v2.8: ì´ ì •ê·œí™”ëŠ” ê³µë°± ì°¨ì´ë§Œ ì²˜ë¦¬í•˜ë©°, ì†ì„± ìˆœì„œ ì°¨ì´(ì˜ˆ: style="a; b" vs style="b; a")ëŠ”
//       false positiveë¥¼ ë°œìƒì‹œí‚¬ ìˆ˜ ìˆìŒ. TipTapì˜ ì†ì„± ìˆœì„œëŠ” ì¼ê´€ì ì´ë¯€ë¡œ ì‹¤ìš©ì ìœ¼ë¡œ ë¬¸ì œ ì—†ìŒ.
function normalizeHtml(html: string): string {
  return html.replace(/\s+/g, ' ').trim();
}

const hasUnsavedChanges = useMemo(() => {
  if (!initialTemplate) return !!(name || subjectTemplate || bodyTemplate); // ìƒˆ í…œí”Œë¦¿ (v2.5: boolean ë°˜í™˜ ë³´ì¥)
  return name !== initialTemplate.name
    || subjectTemplate !== initialTemplate.subjectTemplate
    || normalizeHtml(bodyTemplate) !== normalizeHtml(initialTemplate.bodyTemplate);
}, [name, subjectTemplate, bodyTemplate, initialTemplate]);
```

**í•„ìš” íŒ¨í‚¤ì§€**:
```json
{
  "@tiptap/react": "^2.4.0",
  "@tiptap/starter-kit": "^2.4.0",
  "@tiptap/extension-link": "^2.4.0",
  "@tiptap/extension-table": "^2.4.0",
  "@tiptap/extension-table-row": "^2.4.0",
  "@tiptap/extension-table-cell": "^2.4.0",
  "@tiptap/extension-table-header": "^2.4.0",
  "@tiptap/extension-text-style": "^2.4.0",
  "@tiptap/extension-color": "^2.4.0",
  "@tiptap/extension-text-align": "^2.4.0",
  "@tiptap/extension-underline": "^2.4.0",
  "@tiptap/extension-highlight": "^2.4.0",
  "juice": "^10.0.0"
}
```

### TipTap â†’ inline ìŠ¤íƒ€ì¼ ë³€í™˜

> **ê²°ì • (m5)**: juice ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ í›„ì²˜ë¦¬

```typescript
// src/lib/email/inlineStyles.ts
import juice from 'juice';

export function convertToInlineStyles(html: string): string {
  return juice(html, {
    removeStyleTags: true,
    preserveMediaQueries: false,
  });
}
```

### Clipboard API ë¸Œë¼ìš°ì € í˜¸í™˜ì„±

| ë¸Œë¼ìš°ì € | ì§€ì› ìƒíƒœ | ëŒ€ì‘ |
|----------|----------|------|
| Chrome | âœ… ì™„ì „ ì§€ì› | - |
| Edge | âœ… ì™„ì „ ì§€ì› | - |
| Firefox | âš ï¸ ClipboardItem ë¹„í™œì„±í™” | **ì‚¬ì „ ê°ì§€ ê²½ê³  + [í´ë¦½ë³´ë“œ ë³µì‚¬] ë¹„í™œì„±í™”** (M9, v2.6) |
| Safari | âš ï¸ user gesture ì œì•½ | **Promise íŒ¨í„´ ì ìš©** (M8) |
| IE | âŒ ë¯¸ì§€ì› | ê²½ê³  ë©”ì‹œì§€ í‘œì‹œ |

### Firefox ì‚¬ì „ ê°ì§€ ë° ê²½ê³ 

> **ê²°ì • (M9, v2.6)**: ëª¨ë‹¬ ì—´ê¸° ì‹œ Firefox ê°ì§€í•˜ì—¬ ê²½ê³  í‘œì‹œ + [í´ë¦½ë³´ë“œ ë³µì‚¬] ë²„íŠ¼ ë¹„í™œì„±í™”

```typescript
// src/lib/email/browserCheck.ts

export function checkClipboardSupport(): { supported: boolean; warning?: string } {
  // Firefox ê°ì§€: ClipboardItemì´ undefinedì´ë©´ HTML ë³µì‚¬ ë¶ˆê°€
  if (typeof ClipboardItem === 'undefined') {
    return {
      supported: false,
      warning: 'Firefoxì—ì„œëŠ” HTML ë³µì‚¬ê°€ ì œí•œë©ë‹ˆë‹¤.\n\nabout:configì—ì„œ dom.events.asyncClipboard.clipboardItemì„ trueë¡œ ì„¤ì •í•˜ê±°ë‚˜,\nChrome ë˜ëŠ” Edgeë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.',
    };
  }
  return { supported: true };
}
```

> **Firefox ëª¨ë‹¬ ë™ì‘ (v2.6)**:
> - `checkClipboardSupport().supported === false` ì‹œ:
>   - ëª¨ë‹¬ ìƒë‹¨ì— ê²½ê³  ë°°ë„ˆ í‘œì‹œ (warning ë©”ì‹œì§€)
>   - **[í´ë¦½ë³´ë“œ ë³µì‚¬] ë²„íŠ¼ ë¹„í™œì„±í™”** (`disabled`) + íˆ´íŒ: "ì´ ë¸Œë¼ìš°ì €ì—ì„œëŠ” HTML ë³µì‚¬ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤"
>   - ë¯¸ë¦¬ë³´ê¸°, ì œëª© ë³µì‚¬(plain text)ëŠ” ì •ìƒ ë™ì‘

---

# 6. DB ë§ˆì´ê·¸ë ˆì´ì…˜

## 006_phase2_email_templates.sql

```sql
-- ì´ë©”ì¼ í…œí”Œë¦¿ í…Œì´ë¸” (v2.4: í”„ë¡œì íŠ¸ë³„ ê´€ë¦¬)
CREATE TABLE email_templates (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  project_id TEXT NOT NULL REFERENCES projects(id) ON DELETE CASCADE,  -- v2.4
  name TEXT NOT NULL,
  subject_template TEXT NOT NULL,
  body_template TEXT NOT NULL,
  is_built_in BOOLEAN NOT NULL DEFAULT false,  -- v2.8: NOT NULL ì¶”ê°€
  created_at TIMESTAMPTZ DEFAULT NOW(),
  created_by TEXT,
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- í”„ë¡œì íŠ¸ ë‚´ ì´ë¦„ ì¤‘ë³µ ë°©ì§€ (v2.4: name UNIQUE â†’ project_id + name UNIQUE)
ALTER TABLE email_templates ADD CONSTRAINT uq_email_templates_project_name UNIQUE (project_id, name);

-- ì´ë¦„ ê¸¸ì´ ì œí•œ (v2.2)
ALTER TABLE email_templates ADD CONSTRAINT chk_name_length CHECK (char_length(name) <= 50);

-- updated_at ìë™ ê°±ì‹  íŠ¸ë¦¬ê±°
-- âš ï¸ ì˜ì¡´ì„±: update_updated_at_column() í•¨ìˆ˜ëŠ” 001 ë§ˆì´ê·¸ë ˆì´ì…˜ì—ì„œ ìƒì„±ë¨
CREATE TRIGGER update_email_templates_updated_at
  BEFORE UPDATE ON email_templates
  FOR EACH ROW
  EXECUTE FUNCTION update_updated_at_column();

-- v2.4: í”„ë¡œì íŠ¸ ìƒì„± ì‹œ ê¸°ë³¸ í…œí”Œë¦¿ ìë™ ë³µì‚¬ í•¨ìˆ˜
-- v2.5: SECURITY DEFINERë¡œ ì‹¤í–‰ â€” RLS INSERT policyë¥¼ bypassí•˜ì—¬ ì‹œìŠ¤í…œì´ ìë™ ì‚½ì… ê°€ëŠ¥
-- v2.6: body_templateì— ì‹¤ì œ HTML ì‚½ì… ì‹œ SQL dollar-quoting ($body$...$body$) ì‚¬ìš© ê¶Œì¥
--       â†’ E'' ë¬¸ìì—´ ë‚´ ì¤‘ê´„í˜¸({})Â·ì‘ì€ë”°ì˜´í‘œ(') ì´ìŠ¤ì¼€ì´í”„ ë³µì¡ë„ ì œê±°
CREATE OR REPLACE FUNCTION seed_email_templates_for_project()
RETURNS TRIGGER
SECURITY DEFINER
AS $$
BEGIN
  INSERT INTO email_templates (project_id, name, subject_template, body_template, is_built_in, created_by)
  VALUES
    (NEW.id, 'ê¸°ë³¸',
     '[L10n] {updateDateShort} ì—…ë°ì´íŠ¸ ì¼ì • ì•ˆë‚´',
     $body$<!-- ê¸°ë³¸ í…œí”Œë¦¿ HTML - Â§2.6 "ê¸°ë³¸" í…œí”Œë¦¿ ì „ì²´ HTML ì°¸ì¡° -->$body$,
     true, 'SYSTEM'),
    (NEW.id, 'ìƒì„¸',
     '[L10n] {updateDateShort} ì—…ë°ì´íŠ¸ ì¼ì • ì•ˆë‚´ (ìƒì„¸)',
     $body$<!-- ìƒì„¸ í…œí”Œë¦¿ HTML - Â§2.6 "ìƒì„¸" í…œí”Œë¦¿ ì „ì²´ HTML ì°¸ì¡° -->$body$,
     true, 'SYSTEM');
  RETURN NEW;
EXCEPTION
  WHEN OTHERS THEN
    -- v2.6: ìƒì„¸ ì—ëŸ¬ ë¡œê¹… (PostgreSQL RAISEë¡œ ì—ëŸ¬ ì»¨í…ìŠ¤íŠ¸ ë³´ì¡´)
    -- v2.7: USING ERRCODEë¡œ ì›ë˜ SQLSTATE ë³´ì¡´ (ê¸°ë³¸ P0001 ëŒ€ì‹  ì‹¤ì œ ì—ëŸ¬ ì½”ë“œ ì „íŒŒ)
    RAISE EXCEPTION 'ê¸°ë³¸ ì´ë©”ì¼ í…œí”Œë¦¿ ìƒì„± ì‹¤íŒ¨ (project_id: %). ì›ì¸: % â€” í”„ë¡œì íŠ¸ ìƒì„±ì´ ë¡¤ë°±ë©ë‹ˆë‹¤. ì¬ì‹œë„í•˜ê±°ë‚˜ DB ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.',
      NEW.id, SQLERRM
      USING ERRCODE = SQLSTATE;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_seed_email_templates
  AFTER INSERT ON projects
  FOR EACH ROW
  EXECUTE FUNCTION seed_email_templates_for_project();

-- ê¸°ì¡´ í”„ë¡œì íŠ¸ ë§ˆì´ê·¸ë ˆì´ì…˜ (ë°°í¬ ì‹œ 1íšŒ ì‹¤í–‰)
-- v2.7: E'' â†’ dollar-quotingìœ¼ë¡œ ë³€ê²½í•˜ì—¬ seed í•¨ìˆ˜ì™€ ì¼ê´€ì„± ìœ ì§€
-- âš ï¸ ë ˆì´ìŠ¤ ì»¨ë””ì…˜ ë°©ì§€: WHERE NOT EXISTSê°€ seed íŠ¸ë¦¬ê±°ì™€ì˜ ì¤‘ë³µ ì‚½ì…ì„ ë°©ì§€.
--    ì´ ë§ˆì´ê·¸ë ˆì´ì…˜ì€ ê¸°ì¡´ í”„ë¡œì íŠ¸ì—ë§Œ ì ìš©ë˜ë©°, ì‹ ê·œ í”„ë¡œì íŠ¸ëŠ” seed íŠ¸ë¦¬ê±°ê°€ ì²˜ë¦¬.
INSERT INTO email_templates (project_id, name, subject_template, body_template, is_built_in, created_by)
SELECT p.id, 'ê¸°ë³¸',
  '[L10n] {updateDateShort} ì—…ë°ì´íŠ¸ ì¼ì • ì•ˆë‚´',
  $body$<!-- ê¸°ë³¸ í…œí”Œë¦¿ HTML - Â§2.6 "ê¸°ë³¸" í…œí”Œë¦¿ ì „ì²´ HTML ì°¸ì¡° -->$body$,
  true, 'SYSTEM'
FROM projects p
WHERE NOT EXISTS (
  SELECT 1 FROM email_templates et WHERE et.project_id = p.id AND et.name = 'ê¸°ë³¸'
);

INSERT INTO email_templates (project_id, name, subject_template, body_template, is_built_in, created_by)
SELECT p.id, 'ìƒì„¸',
  '[L10n] {updateDateShort} ì—…ë°ì´íŠ¸ ì¼ì • ì•ˆë‚´ (ìƒì„¸)',
  $body$<!-- ìƒì„¸ í…œí”Œë¦¿ HTML - Â§2.6 "ìƒì„¸" í…œí”Œë¦¿ ì „ì²´ HTML ì°¸ì¡° -->$body$,
  true, 'SYSTEM'
FROM projects p
WHERE NOT EXISTS (
  SELECT 1 FROM email_templates et WHERE et.project_id = p.id AND et.name = 'ìƒì„¸'
);

-- RLS ì •ì±…
ALTER TABLE email_templates ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Authenticated users can read email_templates"
  ON email_templates FOR SELECT
  USING (auth.role() = 'authenticated');

CREATE POLICY "Whitelisted users can insert email_templates"
  ON email_templates FOR INSERT
  WITH CHECK (auth.email() IN (
    'jkcho@wemade.com', 'mine@wemade.com', 'srpark@wemade.com',
    'garden0130@wemade.com', 'hkkim@wemade.com'
  ));

CREATE POLICY "Whitelisted users can update email_templates"
  ON email_templates FOR UPDATE
  USING (auth.email() IN (
    'jkcho@wemade.com', 'mine@wemade.com', 'srpark@wemade.com',
    'garden0130@wemade.com', 'hkkim@wemade.com'
  ));

CREATE POLICY "Whitelisted users can delete custom email_templates"
  ON email_templates FOR DELETE
  USING (
    auth.email() IN (
      'jkcho@wemade.com', 'mine@wemade.com', 'srpark@wemade.com',
      'garden0130@wemade.com', 'hkkim@wemade.com'
    )
    AND is_built_in = false
  );

-- ì¸ë±ìŠ¤
CREATE INDEX idx_email_templates_project_id ON email_templates(project_id);
CREATE INDEX idx_email_templates_is_built_in ON email_templates(is_built_in);
CREATE INDEX idx_email_templates_created_by ON email_templates(created_by);
```

## 006b_phase2_schedule_entries_extension.sql

> **ê²°ì • (v2.2)**: schedule_entriesì— description, assignee ì»¬ëŸ¼ ì¶”ê°€ (ì´ë©”ì¼ í…Œì´ë¸” ë Œë”ë§ìš©)

```sql
-- ì´ë©”ì¼ í…Œì´ë¸”ì— í‘œì‹œí•  ë¶€ê°€ ì •ë³´ ì»¬ëŸ¼ ì¶”ê°€
ALTER TABLE schedule_entries ADD COLUMN description TEXT DEFAULT '';
ALTER TABLE schedule_entries ADD COLUMN assignee TEXT DEFAULT '';
```

> **âš ï¸ ì£¼ì˜**: ê³„ì‚° ì‹œ WorkStageì˜ description/assignee ê°’ì„ ScheduleEntryë¡œ ë³µì‚¬í•´ì•¼ í•¨.
> ê¸°ì¡´ calculateBusinessDate â†’ ScheduleEntry ìƒì„± ë¡œì§ì—ì„œ í•´ë‹¹ í•„ë“œ ë§¤í•‘ ì¶”ê°€ í•„ìš”.
>
> **saveCalculationResult() ì €ì¥ ë¡œì§ (v2.7)**: `saveCalculationResult()` (Shared.md Â§3 ì°¸ì¡°) í˜¸ì¶œ ì‹œ
> schedule_entries INSERTì— `description`ê³¼ `assignee` ì»¬ëŸ¼ ê°’ì„ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.
> - `description`: WorkStage.description â†’ schedule_entries.description
> - `assignee`: WorkStage.assignee â†’ schedule_entries.assignee
> - ë‘ í•„ë“œ ëª¨ë‘ `DEFAULT ''`ì´ë¯€ë¡œ ê°’ì´ ì—†ìœ¼ë©´ ë¹ˆ ë¬¸ìì—´ë¡œ ì €ì¥ë©ë‹ˆë‹¤.

---

# 7. ì‚¬ìš©ì ìŠ¤í† ë¦¬

**ìŠ¤í† ë¦¬ 1**: ì´ë©”ì¼ ë³¸ë¬¸ ìë™ ìƒì„±
- **As a** L10n íŒ€ì›
- **I want to** ê³„ì‚°ëœ ì¼ì •ì„ HTML ì´ë©”ì¼ ë³¸ë¬¸ìœ¼ë¡œ ìë™ ìƒì„±í•˜ê³  ì‹¶ë‹¤
- **So that** í˜‘ë ¥ì—…ì²´ì— ì¼ì •ì„ ë¹ ë¥´ê²Œ ê³µìœ í•  ìˆ˜ ìˆë‹¤
- **ì¸ìˆ˜ ê¸°ì¤€** (v2.2):
  - [ì´ë©”ì¼ ë³µì‚¬] í´ë¦­ â†’ ëª¨ë‹¬ ì—´ë¦¼ + ë¯¸ë¦¬ë³´ê¸° ë Œë”ë§ ì™„ë£Œ (3ì´ˆ ì´ë‚´, ì¸¡ì •: ë²„íŠ¼ í´ë¦­ â†’ `data-testid="email-preview-content"` DOM ìš”ì†Œ ë Œë”ë§ ì™„ë£Œ)
  - [í´ë¦½ë³´ë“œ ë³µì‚¬] í´ë¦­ â†’ HTML + plain text ë™ì‹œ ë³µì‚¬ ì„±ê³µ
  - ë³µì‚¬ëœ HTMLì„ Gmail ì›¹ì— ë¶™ì—¬ë„£ê¸° â†’ ì•„ë˜ ì„œì‹ ìœ ì§€ í™•ì¸ (v2.7: êµ¬ì²´ì  ê¸°ì¤€):
    - âœ… í…Œì´ë¸”: `<table border="1">` í…Œë‘ë¦¬ ë Œë”ë§ë¨
    - âœ… ë³¼ë“œ: `<strong>` ë˜ëŠ” `font-weight: bold` í…ìŠ¤íŠ¸ê°€ êµµê²Œ í‘œì‹œë¨
    - âœ… ìƒ‰ìƒ: inline `color` ìŠ¤íƒ€ì¼ì´ ì ìš©ë¨ (ì˜ˆ: `color: #cc0000`)
    - âœ… ì¸ë¼ì¸ ìŠ¤íƒ€ì¼: juice ë³€í™˜ëœ `style` ì†ì„±ì´ ë³´ì¡´ë¨
  - ëª¨ë“  í…œí”Œë¦¿ ë³€ìˆ˜ 8ê°œ(ë‹¨ìˆœ ì¹˜í™˜ 6ê°œ + ì¡°ê±´ë¶€ ë¸”ë¡ 2ê°œ)ê°€ ì˜¬ë°”ë¥´ê²Œ ì²˜ë¦¬ë¨

**ìŠ¤í† ë¦¬ 2**: í…Œì´ë¸” ì„ íƒ
- **As a** L10n íŒ€ì›
- **I want to** ë°œì‹  ëŒ€ìƒì— ë”°ë¼ ì ì ˆí•œ í…Œì´ë¸”(T1/T2/T3)ì„ ì„ íƒí•˜ê³  ì‹¶ë‹¤
- **So that** ë‚´ë¶€/ì™¸ë¶€ìš©ìœ¼ë¡œ ë‹¤ë¥¸ ì •ë³´ë¥¼ ê³µìœ í•  ìˆ˜ ìˆë‹¤
- **ì¸ìˆ˜ ê¸°ì¤€** (v2.2):
  - T1 ì„ íƒ ì‹œ ì»¬ëŸ¼: #, ë°°ì¹˜, ë§ˆê°, í…Œì´ë¸” ì „ë‹¬, ë‹´ë‹¹ì, ì„¤ëª…
  - T2/T3 ì„ íƒ ì‹œ ì»¬ëŸ¼: #, ë°°ì¹˜, HO, HB, ì„¤ëª…
  - í…Œì´ë¸” ë³€ê²½ í›„ 500ms ì´ë‚´ ë¯¸ë¦¬ë³´ê¸° ê°±ì‹  (v2.8: "ì¦‰ì‹œ" ì •ëŸ‰í™”)
  - í•˜ìœ„ ì¼ê°(depth=1) í¬í•¨ë˜ì–´ í‘œì‹œ

**ìŠ¤í† ë¦¬ 3**: í…œí”Œë¦¿ ì»¤ìŠ¤í„°ë§ˆì´ì§•
- **As a** L10n íŒ€ì›
- **I want to** ìì£¼ ì‚¬ìš©í•˜ëŠ” ì´ë©”ì¼ í˜•ì‹ì„ í…œí”Œë¦¿ìœ¼ë¡œ ì €ì¥í•˜ê³  ì‹¶ë‹¤
- **So that** ë°˜ë³µ ì‘ì—…ì„ ì¤„ì¼ ìˆ˜ ìˆë‹¤
- **ì¸ìˆ˜ ê¸°ì¤€** (v2.2, v2.4):
  - ì„¤ì • > ì´ë©”ì¼ í…œí”Œë¦¿ íƒ­ì—ì„œ [+ ìƒˆ í…œí”Œë¦¿] â†’ ë¹ˆ í¸ì§‘ ëª¨ë‹¬ ì—´ë¦¼ â†’ ì´ë¦„/ì œëª©/ë³¸ë¬¸ ì…ë ¥ â†’ ì €ì¥ ì„±ê³µ
  - [+ ìƒˆ í…œí”Œë¦¿] í´ë¦­ ì‹œ ë¹ˆ í¸ì§‘ ëª¨ë‹¬: ì´ë¦„ í•„ë“œì— í¬ì»¤ìŠ¤, ì œëª©/ë³¸ë¬¸ ë¹ˆ ìƒíƒœ
  - TipTap ì—ë””í„°ì—ì„œ WYSIWYG í¸ì§‘ ê°€ëŠ¥ (Bold, ëª©ë¡, í…Œì´ë¸”, ìƒ‰ìƒ, ë§í¬)
  - ì¢Œìš° ë¶„í•  í¸ì§‘ ëª¨ë‹¬ì—ì„œ ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸° í™•ì¸ ê°€ëŠ¥
  - ê¸°ë³¸ ì œê³µ í…œí”Œë¦¿ í¸ì§‘ ê°€ëŠ¥, ì‚­ì œ ë¶ˆê°€ (ì‚­ì œ ë²„íŠ¼ ì—†ìŒ)
  - ì‚¬ìš©ì ì •ì˜ í…œí”Œë¦¿ í¸ì§‘/ì‚­ì œ ê°€ëŠ¥
  - í…œí”Œë¦¿ì€ í˜„ì¬ ì„ íƒëœ í”„ë¡œì íŠ¸ì— ê·€ì†ë¨ (v2.4)
  - v2.8: ì´ë¦„ ìœ íš¨ì„± ì—£ì§€ ì¼€ì´ìŠ¤ â€” ê³µë°±ë§Œ ì…ë ¥ ì‹œ "ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" ê²½ê³  (trim í›„ ë¹ˆ ë¬¸ìì—´ ê²€ì‚¬), 50ì ì´ˆê³¼ ì‹œ ì €ì¥ ë²„íŠ¼ ë¹„í™œì„±í™”

**ìŠ¤í† ë¦¬ 4**: ì´ë©”ì¼ ë¯¸ë¦¬ë³´ê¸°
- **As a** L10n íŒ€ì›
- **I want to** ì´ë©”ì¼ ë°œì†¡ ì „ ë¯¸ë¦¬ë³´ê¸°ë¥¼ í™•ì¸í•˜ê³  ì‹¶ë‹¤
- **So that** ì˜¤ë¥˜ë¥¼ ì‚¬ì „ì— ë°œê²¬í•  ìˆ˜ ìˆë‹¤
- **ì¸ìˆ˜ ê¸°ì¤€** (v2.2):
  - ë¯¸ë¦¬ë³´ê¸°ì— ì œëª© + ë³¸ë¬¸ ëª¨ë‘ í‘œì‹œ
  - ì œëª© í´ë¦­ ì‹œ ì œëª©ë§Œ í´ë¦½ë³´ë“œ ë³µì‚¬ + í† ìŠ¤íŠ¸
  - [HTML ë³´ê¸°] í† ê¸€ ì‹œ ë Œë”ë§ â†” HTML ì†ŒìŠ¤ ì „í™˜ (v2.8: HTML ì†ŒìŠ¤ëŠ” juice ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ ë³€í™˜ í›„ì˜ ìµœì¢… HTML â€” Â§4.4 íŒŒì´í”„ë¼ì¸ 6ë‹¨ê³„ ê²°ê³¼)
  - í…Œì´ë¸”/í…œí”Œë¦¿ ë³€ê²½ ì‹œ ë¯¸ë¦¬ë³´ê¸° ì‹¤ì‹œê°„ ê°±ì‹ 

---

# 8. ì„±ê³µ ì§€í‘œ

| ê¸°ëŠ¥ | ì§€í‘œ | ëª©í‘œ | ì¸¡ì • ë°©ë²• |
|------|------|------|----------|
| ì´ë©”ì¼ ìƒì„± | ì´ë©”ì¼ ì‘ì„± ì‹œê°„ ë‹¨ì¶• | 80% (10ë¶„ â†’ 2ë¶„) | ì‚¬ìš©ì í”¼ë“œë°± ì„¤ë¬¸ |
| í´ë¦½ë³´ë“œ ë³µì‚¬ | Chrome/Edge ì„±ê³µë¥  | 100% | E2E í…ŒìŠ¤íŠ¸ |
| Gmail í˜¸í™˜ | ë¶™ì—¬ë„£ê¸° í›„ ì„œì‹ ìœ ì§€ | í…Œì´ë¸”/ë³¼ë“œ/ìƒ‰ìƒ ë³´ì¡´ | ìˆ˜ë™ ê²€ì¦ (Â§9 ì²´í¬ë¦¬ìŠ¤íŠ¸) |
| í…œí”Œë¦¿ CRUD | ìƒì„±/ìˆ˜ì •/ì‚­ì œ ì •ìƒ ë™ì‘ | ì—ëŸ¬ ì—†ìŒ | E2E í…ŒìŠ¤íŠ¸ |
| ë³€ìˆ˜ ì¹˜í™˜ | 8ê°œ ë³€ìˆ˜ ëª¨ë‘ ì •ìƒ ì¹˜í™˜ | 100% | ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ |

### ì¸¡ì • ë²”ìœ„

- **ì‹œì‘**: [ì´ë©”ì¼ ë³µì‚¬] ë²„íŠ¼ í´ë¦­
- **ì¢…ë£Œ**: [í´ë¦½ë³´ë“œ ë³µì‚¬] ë²„íŠ¼ í´ë¦­ ì™„ë£Œ
- **ëŒ€ìƒ í™˜ê²½ (v2.7)**: ë°ìŠ¤í¬í†± ë¸Œë¼ìš°ì € ì „ìš© (ìµœì†Œ ë·°í¬íŠ¸ 1280px). ëª¨ë°”ì¼/íƒœë¸”ë¦¿ì€ Phase 2 ë²”ìœ„ ì™¸.

---

# 9. í˜¸í™˜ì„± ê²€ì¦ ê°€ì´ë“œ

### Gmail/Outlook í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

| í´ë¼ì´ì–¸íŠ¸ | ê²€ì¦ í•­ëª© | í•©ê²© ê¸°ì¤€ (v2.7) | ë°©ë²• |
|-----------|----------|-----------------|------|
| **Gmail Web** | í…Œì´ë¸” í…Œë‘ë¦¬, ë³¼ë“œ, ìƒ‰ìƒ | `<table border>` ë Œë”ë§ + `<strong>` êµµê²Œ + `color` ì ìš© | ë¶™ì—¬ë„£ê¸° í›„ ìœ¡ì•ˆ í™•ì¸ |
| **Outlook Web** | í…Œì´ë¸”, ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ | inline `style` ì†ì„± ë³´ì¡´, í…Œì´ë¸” êµ¬ì¡° ìœ ì§€ | ë¶™ì—¬ë„£ê¸° í›„ í™•ì¸ |
| **Outlook Desktop** | í…Œì´ë¸” ë„ˆë¹„, í°íŠ¸ | í…Œì´ë¸” ìµœì†Œ ë„ˆë¹„ ìœ ì§€, Arial í°íŠ¸ ì ìš© | ë°œì‹  í›„ í™•ì¸ |
| **Apple Mail** | ì „ì²´ ì„œì‹ | ëª¨ë“  ìŠ¤íƒ€ì¼ ì •ìƒ ë Œë”ë§ | ë°œì‹  í›„ í™•ì¸ |

### í…ŒìŠ¤íŠ¸ í”Œë¡œìš°

```
[Phase 2 êµ¬í˜„ ì™„ë£Œ]
    â†“
[juiceë¡œ inline ìŠ¤íƒ€ì¼ ë³€í™˜]
    â†“
[í…ŒìŠ¤íŠ¸ ì´ë©”ì¼ 5ê°œ ì£¼ì†Œë¡œ ë°œì‹ ]
    â”œâ”€ Gmail Web
    â”œâ”€ Outlook (Web/Desktop)
    â””â”€ Apple Mail
    â†“
[ìŠ¤í¬ë¦°ìƒ· ë¹„êµ ê²€ì¦]
    â†“
[ë¬¸ì œ ë°œê²¬ ì‹œ ìŠ¤íƒ€ì¼ ì¡°ì •]
```

### ë°°í¬ ì²´í¬ë¦¬ìŠ¤íŠ¸ (v2.6)

> Phase 2 ë°°í¬ ì‹œ í™•ì¸ ì‚¬í•­:

| ìˆœì„œ | í•­ëª© | ì„¤ëª… |
|------|------|------|
| 1 | DB ë§ˆì´ê·¸ë ˆì´ì…˜ | Â§6 `006_phase2_email_templates.sql`, `006b_phase2_schedule_entries_extension.sql` ì‹¤í–‰ |
| 2 | seed íŠ¸ë¦¬ê±° ê²€ì¦ | ì‹ ê·œ í”„ë¡œì íŠ¸ ìƒì„± â†’ ê¸°ë³¸ í…œí”Œë¦¿ 2ì¢… ìë™ ìƒì„± í™•ì¸ |
| 3 | ê¸°ì¡´ í”„ë¡œì íŠ¸ ë§ˆì´ê·¸ë ˆì´ì…˜ | Â§6 í•˜ë‹¨ INSERT SELECT ì¿¼ë¦¬ë¡œ ê¸°ì¡´ í”„ë¡œì íŠ¸ì— ê¸°ë³¸ í…œí”Œë¦¿ ì‚½ì… |
| 4 | npm íŒ¨í‚¤ì§€ ì„¤ì¹˜ | TipTap ê´€ë ¨ íŒ¨í‚¤ì§€ + juice (Â§5 ì°¸ì¡°) |
| 5 | í”„ë¡ íŠ¸ì—”ë“œ ë°°í¬ | Git push â†’ Vercel ìë™ ë°°í¬ |
| 6 | built-in í…œí”Œë¦¿ ê²€ì¦ | `SELECT project_id, name FROM email_templates WHERE is_built_in = true ORDER BY project_id;` â€” ëª¨ë“  í”„ë¡œì íŠ¸ì— 'ê¸°ë³¸', 'ìƒì„¸' 2ì¢… ì¡´ì¬ í™•ì¸ (v2.8) |
| 7 | í˜¸í™˜ì„± ê²€ì¦ | Â§9 ì²´í¬ë¦¬ìŠ¤íŠ¸ ì‹¤í–‰ |

---

# 10. ì°¸ì¡° ë¬¸ì„œ

- **Master**: [Azrael-PRD-Master.md](./Azrael-PRD-Master.md)
- **Shared**: [Azrael-PRD-Shared.md](./Azrael-PRD-Shared.md)
- **Phase 3 (ìŠ¬ë™)**: [Azrael-PRD-Phase3.md](./Azrael-PRD-Phase3.md)
- **Phase 4 (í”„ë¦¬ì…‹)**: [Azrael-PRD-Phase4.md](./Azrael-PRD-Phase4.md)
- **Design**: [Azrael-PRD-Design.md](./Azrael-PRD-Design.md)

---

# 11. ë³€ê²½ ì´ë ¥

| ë‚ ì§œ | ë²„ì „ | ë³€ê²½ ë‚´ìš© |
|------|------|----------|
| 2026-01-26 | 2.0 | Phase ë¶„í•  (ì´ë©”ì¼ë§Œ í¬í•¨) |
| 2026-01-26 | 2.1 | 6ê°œ ì—ì´ì „íŠ¸ ê²€ì¦ ê²°ê³¼ ë°˜ì˜ (C1-C4, M1-M11, m1-m9) |
| 2026-01-30 | 2.2 | 4ê°œ ì—ì´ì „íŠ¸ 2ì°¨ ê²€ì¦ ë°˜ì˜ (56ê±´): ê¸°ë³¸ í…œí”Œë¦¿ ì‚­ì œ ë¶ˆê°€, ì œëª© ë³„ë„ ë³µì‚¬, TipTap ì¼ë°˜ í…ìŠ¤íŠ¸ ì…ë ¥, í¸ì§‘ ëª¨ë‹¬ ì¢Œìš° ë¶„í• (1100px), schedule_entries í™•ì¥(description/assignee), null ë³€ìˆ˜ í”Œë ˆì´ìŠ¤í™€ë”, plain text HTML íƒœê·¸ ì œê±°, ì•¡ì…˜ë°” 4ë²„íŠ¼, ì´ë©”ì¼ ìƒì„± íŒŒì´í”„ë¼ì¸ ì¶”ê°€, ì—ëŸ¬ ì²˜ë¦¬ ëª…ì„¸, ì¸ìˆ˜ ê¸°ì¤€ ì¶”ê°€, T2/T3 HTML ì˜ˆì‹œ, í•„ë“œ-ì»¬ëŸ¼ ë§¤í•‘ |
| 2026-01-30 | 2.3 | 4ê°œ ì—ì´ì „íŠ¸ 3ì°¨ ê²€ì¦ ë°˜ì˜ (8H/18M/34L): [ì´ë©”ì¼ ìƒì„±] ë²„íŠ¼ ì œê±°â†’[ì´ë©”ì¼ ë³µì‚¬]ë¡œ í†µí•©, ì´ë©”ì¼ ë³€ìˆ˜ ë‚ ì§œ MM/DD(ì‹œê°„ ì œì™¸) formatEmailDate ì¶”ê°€, ë¯¸ë¦¬ë³´ê¸° ë°ì´í„°=ì‹¤ì œ í”„ë¡œì íŠ¸ ë°ì´í„°(ì—†ìœ¼ë©´ ë¹„í™œì„±í™”), [+ ìƒˆ í…œí”Œë¦¿]â†’ë¹ˆ í¸ì§‘ ëª¨ë‹¬, EmailGeneratorModal props ì¸í„°í˜ì´ìŠ¤, Database íƒ€ì… email_templates ì¶”ê°€, ì œëª© ë³µì‚¬ plain text ëª…ì‹œ, update_updated_at_column íŠ¸ë¦¬ê±° ì˜ì¡´ì„± ì½”ë©˜íŠ¸ |
| 2026-01-30 | 2.4 | 4ê°œ ì—ì´ì „íŠ¸ 4ì°¨ ê²€ì¦ ë°˜ì˜ (2C/24H/48M/33L): **ì´ë©”ì¼ í…œí”Œë¦¿ í”„ë¡œì íŠ¸ë³„ ê´€ë¦¬** (project_id FK, UNIQUE(project_id,name), seed_email_templates_for_project íŠ¸ë¦¬ê±°, ê¸°ì¡´ í”„ë¡œì íŠ¸ ë§ˆì´ê·¸ë ˆì´ì…˜), ì œëª© ë³µì‚¬ writeText() API+ì—ëŸ¬ ì²˜ë¦¬, generateEmail deps ì£¼ì… íŒ¨í„´, EmailTemplateEditModal/API/Hook ì¸í„°í˜ì´ìŠ¤ ì¶”ê°€, ë³€ìˆ˜ í…Œì´ë¸” "ì‚¬ìš© ê°€ëŠ¥ ìœ„ì¹˜" ì»¬ëŸ¼, showIosReviewDate ì¡°ê±´ë¶€ ë¸”ë¡ ì „ìš© í‘œê¸°, TemplateContext íƒ€ì…, ë³µì‚¬ í›„ ëª¨ë‹¬ ìœ ì§€, ë¹„ì €ì¥ ë³€ê²½ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸, í•˜ìœ„ ì¼ê° ì‹œê°ì  êµ¬ë¶„ ì—†ìŒ, ì‚¬ìš©ì ì •ì˜ ë“œë¡­ë‹¤ìš´ ë¹ˆ ìƒíƒœ ë©”ì‹œì§€, ê³„ì‚° ê²°ê³¼ ìˆìŒ ì •ì˜, Disclaimer/ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ ì²˜ë¦¬, ìŠ¤í† ë¦¬ 3 ì¸ìˆ˜ ê¸°ì¤€ ë³´ê°• |
| 2026-01-30 | 2.5 | 4ê°œ ì—ì´ì „íŠ¸ 5ì°¨ ê²€ì¦ ë°˜ì˜ (2C/24H/46M/38L â†’ ì¤‘ë³µ ì œê±° í›„ 27A+4B): **ë³´ì•ˆ**: sanitizer í”Œë ˆì´ìŠ¤í™€ë” UUID ê¸°ë°˜ ë³€ê²½, ì¤‘ì²© {{#if}} ê°ì§€ ê²½ê³ . **íƒ€ì… í†µì¼**: replaceVariables/processConditionals TemplateContext íƒ€ì…, booleanâ†’String ë³€í™˜. **ëˆ„ë½ ì‹œê·¸ë‹ˆì²˜**: getEntriesByTableType, formatTableHtml, htmlToPlainText, renderDisclaimerHtml, stripHtmlTags ì¶”ê°€. **íŒŒì´í”„ë¼ì¸**: juice ë³€í™˜ 6ë‹¨ê³„ ëª…ì‹œ, subject HTML strip, TipTap HTML entity ë””ì½”ë”© ì „ì²˜ë¦¬. **Disclaimer**: ë¹ˆ ê°’ ì‹œ ë¸”ë¡ ì „ì²´ ìˆ¨ê¹€ ({{#if disclaimer}}). **UX**: TipTap dirty ê°ì§€ HTML ì •ê·œí™”, ì œëª© í•„ë“œ ë³€ìˆ˜=ì§ì ‘ íƒ€ì´í•‘ë§Œ, í…œí”Œë¦¿ ë¯¸ì„ íƒ ì‹œ ë¯¸ë¦¬ë³´ê¸° ë©”ì‹œì§€, ë¡œë”© ìŠ¤í”¼ë„ˆ, HTML ë³´ê¸° ìƒíƒœ. **DB**: seed íŠ¸ë¦¬ê±° SECURITY DEFINER, ì‹¤íŒ¨ ì‹œ ë¡¤ë°± ë™ì‘ ëª…ì‹œ, useDeleteEmailTemplate projectId. **ê¸°íƒ€**: ë°°ê²½ì„¤ëª… í•˜ë“œì½”ë”© ìœ ì§€, ì´ˆê¸°í™” ê¸°ëŠ¥ ì—†ìŒ, snakeâ†’camelCase ë³€í™˜ ì½”ë©˜íŠ¸ |
| 2026-01-30 | 2.6 | 4ê°œ ì—ì´ì „íŠ¸ 6ì°¨ ê²€ì¦ ë°˜ì˜ (0C/6H/22M/42L â†’ ì¤‘ë³µ ì œê±° í›„ 38A+12B): **Regex**: ì¤‘ì²© {{#if}} ê°ì§€ ì •í™•ë„ ê°œì„  ({{/if}} ê²½ê³„ ì¸ì‹). **UI/UX**: ì™€ì´ì–´í”„ë ˆì„ ë‚ ì§œ `02-10` (MM-DD) í†µì¼, í¸ì§‘ ëª¨ë‹¬ì— í…Œì´ë¸” ì„ íƒ ë“œë¡­ë‹¤ìš´ ì¶”ê°€, ë¯¸ë¦¬ë³´ê¸° 300ms ë””ë°”ìš´ìŠ¤, HTML ë³´ê¸° í† ê¸€ ë¼ë²¨ ëª…ì‹œ (juice ë³€í™˜ í›„ HTML), ì‚¬ìš©ì ì •ì˜ 0ê°œ ì‹œ ë¼ë””ì˜¤ ë¹„í™œì„±í™”, Firefox ê²½ê³  + [í´ë¦½ë³´ë“œ ë³µì‚¬] ë¹„í™œì„±í™”, ëª¨ë‹¬ ì—´ê¸° ì‹œ ìƒíƒœ ì´ˆê¸°í™”, í…œí”Œë¦¿ ë¡œë”© ì‹¤íŒ¨ UI. **Props**: EmailPreview/EmailTemplateSelector/EmailTemplateEditor Props ì¶”ê°€, useUpdateEmailTemplate êµ¬í˜„ ëª…ì‹œ, useCreateEmailTemplate data íƒ€ì… êµ¬ì²´í™”. **DB**: seed body_template SQL dollar-quoting, seed ì‹¤íŒ¨ ì‹œ ìƒì„¸ ì—ëŸ¬ ë©”ì‹œì§€ + EXCEPTION ë¸”ë¡, Insert created_by null í—ˆìš©, Â§4.2â†”Â§6 ì°¸ì¡° ê´€ê³„ ëª…ì‹œ. **Disclaimer**: ê³µë°± ì „ìš© ë¹ˆ ì·¨ê¸‰ (trim+strip), renderDisclaimerHtml ì²˜ë¦¬ ìˆœì„œ ëª…ì‹œ. **ë³´ì•ˆ**: sanitizer í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ 7ê±´ ì¶”ê°€. **ë¬¸ì„œ**: sanitizer.ts ë””ë ‰í† ë¦¬ íŠ¸ë¦¬ ì¶”ê°€, iosReviewDate=null ì¡°ê±´ í•´ì„¤, ì¤‘ì²© {{#if}} ë™ì‘ ì„¤ëª… ê°œì„ , ë°°í¬ ì²´í¬ë¦¬ìŠ¤íŠ¸ ì¶”ê°€ |
| 2026-01-30 | 2.7 | 4ê°œ ì—ì´ì „íŠ¸ 7ì°¨ ê²€ì¦ ë°˜ì˜ (0C/12H/32M/20L â†’ ì¤‘ë³µ ì œê±° í›„ 39A+4B): **ìœ íš¨ì„± ê²€ì¦**: boolean ë³€ìˆ˜ ë‹¨ìˆœ ì‚¬ìš© ê²½ê³ , ë‹«íˆì§€ ì•Šì€ {{/if}} ê°ì§€, TipTap HTML ê¹¨ì§„ ë³€ìˆ˜ ê°ì§€ (ì‚¬ìš©ì ì±…ì„+ê²½ê³  ì •ì±…). **Modal**: ê¸°ì¡´ Modalì— maxWidth prop ì¶”ê°€ (EmailGeneratorModal 800px, EditModal 1100px), EmailGeneratorModal ë‚´ë¶€ ìƒíƒœ (emailResult/isGenerating), [í´ë¦½ë³´ë“œ ë³µì‚¬] í™œì„±í™” ì¡°ê±´ ëª…ì‹œ, ë³µì‚¬ ë²„íŠ¼ ë¡œë”© ìƒíƒœ. **íŒŒì´í”„ë¼ì¸**: generateEmail asyncâ†’sync ë³€í™˜, getEntriesByTableType children í‰íƒ„í™” ë¡œì§, sanitizer í…ŒìŠ¤íŠ¸ íŒŒì´í”„ë¼ì¸ ë‹¨ê³„ ëª…í™•í™” (sanitizer ì¶œë ¥ vs ìµœì¢… HTML). **DB**: seed EXCEPTION SQLSTATE ë³´ì¡´ (USING ERRCODE), ê¸°ì¡´ ë§ˆì´ê·¸ë ˆì´ì…˜ dollar-quoting í†µì¼, ë ˆì´ìŠ¤ ì»¨ë””ì…˜ ë°©ì§€ ì£¼ì„, is_built_in TypeScript ë ˆë²¨ ë³´í˜¸ ì „ëµ. **UX**: ì¡°ê±´ë¶€ ë¸”ë¡ ì‚½ì… ì‹œ ê¸°ë³¸ ë‚´ìš© í¬í•¨, í…œí”Œë¦¿ ì •ë ¬ ìˆœì„œ (built-in ë¨¼ì €+created_at DESC), ì‚¬ìš©ì ì •ì˜ ë“œë¡­ë‹¤ìš´ ì´ˆê¸° ì„ íƒê°’, ì„¤ì • íƒ­ í”„ë¡œì íŠ¸ ë³€ê²½ ì‹œ ìë™ ê°±ì‹ , TipTap key prop, ë°ìŠ¤í¬í†± ì „ìš© ëª…ì‹œ. **ê¸°íƒ€**: ê¸°ë³¸ í…œí”Œë¦¿ subject_template í‘œ ì¶”ê°€, í”Œë ˆì¸í…ìŠ¤íŠ¸ `<a>` ë³€í™˜ ê·œì¹™, Gmail í˜¸í™˜ì„± í•©ê²© ê¸°ì¤€ êµ¬ì²´í™”, EmailTemplate ë‚ ì§œ í•„ë“œ string íŒ¨í„´ ì½”ë©˜íŠ¸, schedule_entries saveCalculationResult ì €ì¥ ë¡œì§ |
| 2026-01-30 | 2.8 | 4ê°œ ì—ì´ì „íŠ¸ 8ì°¨ ê²€ì¦ ë°˜ì˜ (0C/17H/25M/25L â†’ ì¤‘ë³µ ì œê±° í›„ 28A+4B): **DB**: is_built_in NOT NULL DEFAULT false, update_updated_at_column() ì˜ì¡´ì„± 001 ë§ˆì´ê·¸ë ˆì´ì…˜ìœ¼ë¡œ ì •ì •, RLS auth.email() íŒ¨í„´ í‘œì¤€í™” ë…¸íŠ¸, Insert íƒ€ì… is_built_in ê²½ê³  ì£¼ì„, ë°°í¬ ì²´í¬ë¦¬ìŠ¤íŠ¸ built-in ê²€ì¦ SQL ì¶”ê°€. **íƒ€ì…/ì¸í„°í˜ì´ìŠ¤**: TemplateCategory íƒ€ì… + ë¼ë””ì˜¤-to-ID ë§¤í•‘, Modal footer prop ë³´ì¡´, EmailGeneratorModalì— project prop ì¶”ê°€, Database íƒ€ì… ê¸°ì¡´ í…Œì´ë¸” ì°¸ì¡° ë…¸íŠ¸. **íŒŒì´í”„ë¼ì¸**: renderTemplate orphaned ë¸”ë¡ console.warn, renderDisclaimerHtml ë‚´ë¶€ try/catch ë…¸íŠ¸, formatEmailDate Invalid Date ì²˜ë¦¬. **UX**: selectedTemplateId ì´ˆê¸°í™” useEffect íŒ¨í„´, ëª¨ë‹¬ ìƒíƒœ ë¦¬ì…‹ êµ¬í˜„ íŒ¨í„´, EditModal draft ìƒíƒœ ì„ ì–¸, useDebouncedValue í›… íŒ¨í„´, TipTap key null ì²˜ë¦¬, normalizeHtml false positive ì œí•œ ë…¸íŠ¸. **ì •ëŸ‰í™”**: "ì¦‰ì‹œ" â†’ 500ms, 3ì´ˆ ì„±ëŠ¥ ê¸°ì¤€ data-testid ì¸¡ì •. **ìŠ¤í† ë¦¬**: Story 3 ì´ë¦„ ìœ íš¨ì„± ì—£ì§€ ì¼€ì´ìŠ¤, Story 4 HTML ë³´ê¸° post-juice ëª…í™•í™”. **í”Œë ˆì¸í…ìŠ¤íŠ¸**: ë¹ˆ í…Œì´ë¸”/colspan ì—£ì§€ ì¼€ì´ìŠ¤, getEntriesByTableType dot-notation index. **ì •ë ¬**: 3ì°¨ ì •ë ¬ ê¸°ì¤€(name ASC) ì¶”ê°€, showIosReviewDate í˜•ì‹ ì„¤ëª… ë³´ê°•. **í˜¸í™˜ì„±**: Gmail App ëª¨ë°”ì¼ í•­ëª© ì œê±° (ë°ìŠ¤í¬í†± ì „ìš©). **EditModal**: onSave ì½œë°± ë®¤í…Œì´ì…˜ ëª¨ë‹¬ ë‚´ë¶€ ì²˜ë¦¬ ëª…ì‹œ, isGenerating useMemo ë³€í™˜ ë…¸íŠ¸ |

| 2026-02-02 | 2.9 | **êµ¬í˜„ ì™„ë£Œ + UI/UX ê°ì‚¬ ê°œì„ **: ì´ë©”ì¼ ìƒì„± ê¸°ëŠ¥ ì „ì²´ êµ¬í˜„ ì™„ë£Œ. UI/UX ê°ì‚¬ ë°˜ì˜ â€” ë²„íŠ¼ í…ìŠ¤íŠ¸ ê°œí–‰ ë°©ì§€(`white-space: nowrap`), ì„¤ì • 4ê°œ íƒ­ "ì¶”ê°€" ë²„íŠ¼ ìš°ì¸¡ ìƒë‹¨ í†µì¼(flex í—¤ë” íŒ¨í„´), ì‚¬ì´ë“œë°” í™œì„± íƒ­ ë°°ê²½ìƒ‰(`--azrael-orange-50`), ë©”ì¸ input-section ì»¨í…Œì´ë„ˆ `max-width` 800â†’960px í™•ëŒ€ + ë²„íŠ¼ ìˆ˜í‰/ìˆ˜ì§ ì¤‘ì•™ ì •ë ¬ |

---

**ë¬¸ì„œ ì¢…ë£Œ**
